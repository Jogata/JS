<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>URLSearchParams in JS</title>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css"/> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  </head>
  <body>
    <h1>URLSearchParams in JavaScript - Constructing Query Strings</h1>

<header style="display: none;">
  <h2>JS Advanced Exam Prep - 20 February 2021</h2>
  <a href="../../00exams/JS Advanced Regular Exam - 20 February 2021">Open folder</a>
</header>

<script>
/* 130 */
 class Story {
  constructor(title, creator) {
      this.title = title;
      this.creator = creator;
      this._comments = [];
      this._likes = [];
  }

  get likes() {
      if (this._likes.length === 0) {
          return `${this.title} has 0 likes`;
      } else if (this._likes.length === 1) {
          return `${this._likes[0]} likes this story!`;
      } 

      return `${this._likes[0]} and ${this._likes.slice(1).length} others like this story!`;
  }

  like(username) {
      if (this._likes.includes(username)) {
          throw new Error("You can't like the same story twice!");
      } 

      if (username === this.creator) {
          throw new Error("You can't like your own story!");
      } 

      this._likes.push(username);
      return `${username} liked ${this.title}!`;
  }

  dislike(username) {
      if (!this._likes.includes(username)) {
          throw new Error("You can't dislike this story!");
      } 

      this._likes = this._likes.filter(user => user !== username);

      return `${username} disliked ${this.title}`;
  }

  comment(username, content, id) {
      let comment = {
          Id: id,
          Username: username,
          Content: content,
          Replies: [],
      };

      let commentWithId = this._comments.find(c => c.Id === id);

      if (commentWithId) {
          let replyID = Number(commentWithId.Id + '.' + (commentWithId.Replies.length + 1));
          let reply = {
              Id: replyID,
              Username: username,
              Content: content,
          };

          commentWithId.Replies.push(reply);

          return 'You replied successfully';
      } 

      comment.Id = this._comments.length + 1;
      this._comments.push(comment);

      return `${username} commented on ${this.title}`;
  }

  toString(sortingType) {
      let result = [];
      result.push(`Title: ${this.title}`);
      result.push(`Creator: ${this.creator}`);
      result.push(`Likes: ${this._likes.length}`);
      result.push('Comments:');

      if (this._comments.length > 0) {
          let sortedComments = this._sortCriteria(this._comments, sortingType);
          result.push(this._sortThem(sortedComments, sortingType));
      } 
    return result.join('\n');
  }

  _sortCriteria(commentsOrReplies, criteria) {
      let copyCommentsOrReplies = commentsOrReplies.slice();
      let sortedCommentsOrReplies = null;

      if (criteria === 'asc') {
          sortedCommentsOrReplies = copyCommentsOrReplies.sort((a, b) => a.Id - b.Id);
      } else if (criteria === 'desc') {
          sortedCommentsOrReplies = copyCommentsOrReplies.sort((a, b) => b.Id - a.Id);
      } else if (criteria === 'username') {
          sortedCommentsOrReplies = copyCommentsOrReplies.sort((a, b) => a.Username.localeCompare(b.Username));
      } 


      return sortedCommentsOrReplies;
  }

  _sortThem(sortedComments, criteria) {
      let commentAndReplies = [];

      for (let comment of sortedComments) {
          commentAndReplies.push(`-- ${comment.Id}. ${comment.Username}: ${comment.Content}`);

          if (comment.Replies.length > 0) {
              let sortedReplies = this._sortCriteria(comment.Replies, criteria);
              sortedReplies.forEach(r => commentAndReplies.push(`--- ${r.Id}. ${r.Username}: ${r.Content}`));
          }
      } 

      return commentAndReplies.join('\n');
  }
}

let art = new Story("My Story", "Anny");
art.like("John");
console.log(art.likes);
art.dislike("John");
console.log(art.likes);
art.comment("Sammy", "Some Content");
console.log(art.comment("Ammy", "New Content"));
art.comment("Zane", "Reply", 1);
art.comment("Jessy", "Nice :)");
console.log(art.comment("SAmmy", "Reply@", 1));
console.log();
console.log(art.toString('username'));
console.log();
art.like("Zane");
console.log(art.toString('desc'));
</script>


    <script src="./in-fetch-api.js"></script>
    <script src="js.js">
      // Create Query String as String
      const queryStringSample = 'name=Dom&age=36&occupation=Software+Developer';
      // Create URLSearchParams Object from String
      const uspFromString = new URLSearchParams(queryStringSample);
      console.log(uspFromString);

      // Create Query String as Object
      const queryStringSampleAsObject = {
        name: 'Dom',
        age: 36,
        occupation: 'Software Developer',
      };

      // Create URLSearchParams Object from Object
      const uspFromObject = new URLSearchParams(queryStringSampleAsObject);

      // Get Param from URLSearchParams
      const name = uspFromObject.get('name');
      console.log(`Value of 'name': ${name}`);

      // Change Param in URLSearchParams
      uspFromObject.set('name', 'New Name');
      // Set New Param in URLSearchParams
      uspFromObject.set('programming language', 'JavaScript');

      for (const [key, value] of uspFromObject) {
        console.log(`${key} => ${value}`);
      }

      // Convert URLSearchParams Object to Query String
      console.log(uspFromString.toString());
      console.log(uspFromObject.toString());
    </script>
  </body>
</html>
<!-- 55 -->