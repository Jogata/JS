<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  </head>
  <body>
    <!-- <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1> -->

    <script>
      class JobOffers {
          constructor(employer, position) {
              this.employer = employer;
              this.position  = position;
              this.jobCandidates = [];
          }

          jobApplication(candidates) {

              const added = [];

              for (const candidate of candidates) {
                  const data = candidate.split("-");
                  const name = data[0];
                  const education = data[1];
                  const yearsExperience = Number(data[2]);
                  // console.log(this.jobCandidates);

                  const index = this.jobCandidates.findIndex(candidate => candidate.name == name);
                  // console.log(index);

                  if (index >= 0) {
                      
                      const candidate = this.jobCandidates[index];
                      
                      if (candidate.yearsExperience < yearsExperience) {
                          candidate.yearsExperience = yearsExperience;
                      }

                  } else {
                      
                      const candidate = {
                          name, 
                          education, 
                          yearsExperience
                      }

                      this.jobCandidates.push(candidate);
                      added.push(name);
                      
                  }

              }

              return `You successfully added candidates: ${added.join(", ")}.`;
              
          }

          jobOffer(chosenPerson) {

              const data = chosenPerson.split("-");
              const name = data[0];
              const minimalExperience = Number(data[1]);

              const index = this.jobCandidates.findIndex(candidate => candidate.name == name);
              
              if (index < 0) {
                  throw new Error(`${name} is not in the candidates list!`);
              }

              const candidate = this.jobCandidates[index];

              if (candidate.yearsExperience < minimalExperience) {
                  throw new Error(`${name} does not have enough experience as ${this.position}, minimum requirement is ${minimalExperience} years.`);
              }

              candidate.yearsExperience = "hired";

              return `Welcome aboard, our newest employee is ${name}.`;

          }

          salaryBonus(name) {

              const index = this.jobCandidates.findIndex(candidate => candidate.name == name);
              
              if (index < 0) {
                  throw new Error(`${name} is not in the candidates list!`);
              }

              const candidate = this.jobCandidates[index];
              // console.log(candidate);

              const validEducations = {
                  "Bachelor": "Bachelor", 
                  "Master": "Master"
              }

              const messages = {
                  "Bachelor": `${name} will sign a contract for ${this.employer}, as ${this.position} with a salary of $50,000 per year!`, 
                  "Master": `${name} will sign a contract for ${this.employer}, as ${this.position} with a salary of $60,000 per year!`, 
                  "undefined": `${name} will sign a contract for ${this.employer}, as ${this.position} with a salary of $40,000 per year!`
              }

              const desiredDegree = validEducations[candidate.education];
              const message = messages[desiredDegree];

              return message;

          }

          candidatesDatabase() {

              if (this.jobCandidates.length == 0) {
                  throw new Error("Candidate Database is empty!");
              }

              const result = ["Candidates list:"];

              const sorted = this.jobCandidates.sort((c1, c2) => c1.name.localeCompare(c2.name));

              for (const candidate of sorted) {
                  // console.log(candidate);
                  const info = `${candidate.name}-${candidate.yearsExperience}`;
                  result.push(info);
              }

              return result.join("\n");

          }

      }

      // let Jobs = new JobOffers ("Google", "Strategy Analyst");
      // console.log(Jobs.jobApplication(["John Doe-Bachelor-10", "Peter Parker-Master-5", "Daniel Jones- Bachelor-18"]));

      // let Jobs = new JobOffers ("Google", "Strategy Analyst");
      // console.log(Jobs.jobApplication(["John Doe-Bachelor-10", "Peter Parker-Master-5", "Daniel Jones- Bachelor-18"]));
      // console.log(Jobs.jobOffer("John Doe-8"));
      // console.log(Jobs.jobOffer("Peter Parker-4"));
      // console.log(Jobs.jobOffer("John Jones-8"));

      // let Jobs = new JobOffers ("Google", "Strategy Analyst");
      // console.log(Jobs.jobApplication(["John Doe-Bachelor-10", "Peter Parker-Master-5", "Daniel Jones- Bachelor-18"]));
      // console.log(Jobs.jobOffer("John Doe-8"));
      // console.log(Jobs.jobOffer("Peter Parker-4"));
      // console.log(Jobs.salaryBonus("John Doe"));
      // console.log(Jobs.salaryBonus("Peter Parker"));

      let Jobs = new JobOffers ("Google", "Strategy Analyst");
      console.log(Jobs.jobApplication(["John Doe-Bachelor-10", "Peter Parker-Master-5","Jordan Cole-High School-5", "Daniel Jones- Bachelor-18"]));
      console.log(Jobs.jobOffer("John Doe-8"));
      console.log(Jobs.jobOffer("Peter Parker-4"));
      console.log(Jobs.jobOffer("Jordan Cole-4"));
      console.log(Jobs.salaryBonus("Jordan Cole"));
      console.log(Jobs.salaryBonus("John Doe"));
      console.log(Jobs.candidatesDatabase());

  </script>

<script>
  // 10. Contacts Builder✶
  // 11. View Model✶
  // 12. Payment Package
  // 13. String Builder *✶
</script>

    <!-- ================= Get data from local JSON file ================= -->

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      const matches4 = `
      40 Desert Blade (Fragment)
40 Minotaur's Head (Fragment)
40 Diviner's Orb - Recipe (Fragment)
50 Panoptic Orb - Recipe (Fragment)
80 Hand of Glory (Fragment)

40 Book of Prophecies - Recipe (Fragment)
50 Book of Fate - Recipe (Fragment)
80 Flaming Heart (Fragment)
160 Pastor's Seal (Fragment)

80 Riversar's Tiara (Fragment)
`;
      const matches3 = `740/120/100      640/320/150`;

const patern = /[0-9]+/g;

const result = matches3.match(patern).reduce((acc, n) => acc + Number(n), 0);
console.log(result);
    </script>
  </body>
</html>