<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      // 01. Old Books

      function findBook(books) {
        const book = books[0];
        let index = 0;
        let isFound = false;

        while (index < books.length) {
          index++;
          const input = books[index];

          if (input === "No More Books") {
            break;
          } else if (input === book) {
            isFound = true;
            console.log(`You checked ${index-1} books and found it.`);
            break;
          }
        }

        if (!isFound) {
          console.log("The book you search is not here!");
          console.log(`You checked ${index - 1} books.`);
        }
      }

      // findBook(["Troy", "Stronger", "Life Style", "Troy"]);
      // findBook(["The Spot", "Hunger Games", "Harry Potter", "Torronto", "Spotify", "No More Books"]);
      // findBook(["Bourne", "True Story", "Forever", "More Space", "The Girl", "Spaceship", "Strongest", "Profit", "Tripple", "Stella", "The Matrix", "Bourne"]);

      // 04. Walking

      function calcSteps(arr) {
        const goal = 10000;
        let index = 0;
        let input = Number(arr[index]);
        let total = 0;

        while (input !== "Going home") {
          input = arr[index];

          if (input !== "Going home") {
            total += Number(input);

            if (total >= goal) {
              break;
            }
          } else {
            total += Number(arr[index+1]);
          }

          index++;
        }

        if (total >= goal) {
          const diff = total - goal;
          console.log("Goal reached! Good job!");
          console.log(`${diff} steps over the goal!`);
        } else {
          const diff = goal - total;
          console.log(`${diff} more steps to reach goal.`);
        }
      }

      // calcSteps(["1000", "1500", "2000", "6500"]);
      // calcSteps(["1500", "3000", "250", "1548", "2000", "Going home", "2000"]);
      // calcSteps(["1500", "300", "2500", "3000", "Going home", "200"]);
      // calcSteps(["125", "250", "4000", "30", "2678", "4682"]);

      // 05. Coins

      function calcChange(input) {
        let change = (Number(input[0]) * 100).toFixed(2);
        let index = 0;
        const coins = [2, 1, 0.5, 0.2, 0.1, 0.05, 0.02, 0.01];

        let n = 0;

        while (change > 0) {
          const coin = coins[index]*100;

          
          if (change >= coin) {
            // console.log(coin);
            change -= coin;
            // console.log(change);
            n++;

            if (change === 0) {
              break;
            }
          } else {
            index++;
          }
        }

        console.log(n);
      }

      // calcChange(["1.23"]);
      // calcChange(["2"]);
      // calcChange(["0.56"]);
      // calcChange(["2.73"]);

      // 06. Cake

      function calcCake(arr) {
        const w = Number(arr[0]);
        const l = Number(arr[1]);
        let area = w * l;
        let index = 2;

        while (area > 0) {
          const input = arr[index];

          if (input !== "STOP") {
            area -= Number(input);

            if (area <= 0) {
              console.log(`No more cake left! You need ${area * (-1)} pieces more.`);
              break;
            }
          } else {
            console.log(`${area} pieces are left.`);
            break;
          }

          index++;

          if (index > arr.length) {
            break;
          }
        }
      }

      // calcCake(["10", "2", "2", "4", "6", "STOP"]);
      // calcCake(["10", "10", "20", "20", "20", "20", "21"]);

      function restOperator(a, ...nums) {
        console.log(a);
        console.log(nums);

        let total = 0;

        for (const n of nums) {
          total += n;
        }

        return total;
      }

      const result = restOperator(5, 10, 20);
      console.log(result);

    </script>
  </body>
</html>