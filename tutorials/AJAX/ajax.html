<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <style>
      @import url(https://fonts.googleapis.com/css?family=Open+Sans);
        input[type=text] {
            padding: 12px 20px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type=button] {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        body {
            margin: auto;
            width: 25%;
            text-align: center;
            padding: 20px;
            font-family: 'Open Sans', serif;
        }
        #schedule {
            text-align: center;
            width: 400px;
        }
        input {
            width: 120px;
        }
        #info {
            background-color: aquamarine;
            border: 1px none black;
            border-radius: 4px;
            margin: 0.25em;
        }
        .info {
            font-size: 1.5em;
            padding: 0.25em;
        }
    </style>
  </head>
  <body>
    <!-- <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1> -->
    <label for="username">GitHub username:</label>
    <input type="text" id="username" value="k1r1L" />
    <button onclick="loadRepos()">Load Repos</button>
    <ul id="repos">
        <li>
            <a href="{repo.html_url}">
                {repo.full_name}
            </a>
        </li>
    </ul>

    <script>
      function loadRepos() {
	// console.log("TODO...");
	const username = document.getElementById("username").value;
	const url = `https://api.github.com/users/${username}/repos`;

	const outputField = document.getElementById("repos");
	outputField.textContent = "";

	fetch(url)
		.then(onResponse)
		// .then(data => {
		// 	console.log(data);
		// 	return data;
		// })
		.then(onSuccess)
		.catch(onError);

		function onResponse(response) {

			if (!response.ok) {
				throw "Error";
			}

			return response.json();
		}

		function onSuccess(data) {
			// console.log(data);
			data.forEach(repo => {
				// console.log(repo);
				const li = createLi(repo);
				// console.log(li);
				outputField.appendChild(li);			
			})
		}

		function onError(error) {
			console.log(error);
			outputField.innerText = error;
		}

	function createLi(repo) {
		const li = document.createElement("li");
		const anchor = document.createElement("a");
		anchor.href = repo.html_url;
		anchor.textContent = repo.full_name;
		li.appendChild(anchor);
		// console.log(anchor);
		return li;
	}
}
    </script>

    <div id="schedule">
      <div id="info"><span class="info">Not Connected</span></div>
      <div id="controls">
          <input id="depart" value="Depart" type="button" onclick="result1.depart()">
          <input id="arrive" value="Arrive" type="button" onclick="result1.arrive()" disabled="true">
      </div>
    </div>

    <script>
      function solve() {
    // console.log("solved");
    const url = "http://localhost:3030/jsonstore/bus/schedule";
    let id = "depot";
    let stopName = "";
    // let nextID = "";

    const stopOutput = document.querySelector(".info");

    const departBtn = document.getElementById("depart");
    const arriveBtn = document.getElementById("arrive");

    // fetch(url + "/" + id)
    // .then(response => response.json())
    // .then(data => console.log(data));

    function depart() {
        // console.log('Depart TODO...');
        fetch(url + "/" + id)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Error");
                }
                // return;
                return response.json();
            })
            .then(data => {
                // console.log(data);
                departBtn.disabled = true;
                arriveBtn.disabled = false;
                stopOutput.textContent = `Next stop ${data.name}`;
                id = data.next;
                stopName = data.name;
            })
            .catch(err => {
                stopOutput.textContent = `Error`;
                departBtn.disabled = true;
                arriveBtn.disabled = true;
            })
    }

    function arrive() {
        // console.log('Arrive TODO...');
        stopOutput.textContent = `Arriving at ${stopName}`;
        departBtn.disabled = false;
        arriveBtn.disabled = true;
    }

    return {
        depart,
        arrive
    };
}

let result1 = solve();
// console.log(result.depart);
    </script>

<script>
  // 10. Contacts Builder✶
  // 11. View Model✶
  // 12. Payment Package
  // 13. String Builder *✶
</script>

    <!-- ================= Get data from local JSON file ================= -->

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      const matches4 = `
      40 Desert Blade (Fragment)
40 Minotaur's Head (Fragment)
40 Diviner's Orb - Recipe (Fragment)
50 Panoptic Orb - Recipe (Fragment)
80 Hand of Glory (Fragment)

40 Book of Prophecies - Recipe (Fragment)
50 Book of Fate - Recipe (Fragment)
80 Flaming Heart (Fragment)
160 Pastor's Seal (Fragment)

80 Riversar's Tiara (Fragment)
`;
      const matches3 = `740/120/100      640/320/150`;

const patern = /[0-9]+/g;

const result = matches3.match(patern).reduce((acc, n) => acc + Number(n), 0);
console.log(result);
    </script>
  </body>
</html>