<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      // 03. Sum Prime Non Prime

      function sumPrimeNonPrime(numbers) {
        let index = 0;
        let input = numbers[index];
        let sumPrime = 0;
        let sumNonPrime = 0;

        while (input !== "stop") {
          let number = Number(input);

          if (number < 0) {
            console.log("Number is negative.");
            index++;
            input = numbers[index];
            continue;
          }

          if (number === 2) {
            sumPrime += 2;
          }

          for (let i = 2; i < number; i++) {
            
            if (number % i === 0) {
              sumNonPrime += number;
              break;
            } else if (i === (number - 1)) {
              sumPrime += number;
            }
            
          }
          
          index++;
          input = numbers[index];
        }

        console.log(`Sum of all prime numbers is: ${sumPrime}`);
        console.log(`Sum of all non prime numbers is: ${sumNonPrime}`);
      }

      // sumPrimeNonPrime(["3", "9", "0", "7", "19", "4", "stop"]);
      // sumPrimeNonPrime(["30", "83", "33", "-1", "20", "2", "stop"]);
      // sumPrimeNonPrime(["0", "-9", "0", "stop"]);
      // sumPrimeNonPrime(["2", "stop"]);

      // 04. Train The Trainers

      function trainTheTrainers(data) {
        const judges = Number(data[0]);
        let presentation = data[1];
        let index = 1;
        let input = 0;

        let totalMark = 0;
        let presentations = 0;
                
        while (input !== "Finish") {
          let presentationMark = 0;
          
          for (let i = 0; i < judges; i++) {
            index++;
            input = Number(data[index]);
            presentationMark += input;
          }

          presentationMark = presentationMark / judges;
          console.log(`${presentation} - ${presentationMark.toFixed(2)}.`);

          totalMark += presentationMark;
          presentations++;

          index++;
          input = data[index];
          presentation = input;
        }

        console.log(`Student's final assessment is ${(totalMark / presentations).toFixed(2)}.`);
      }

      // trainTheTrainers(["2", "While-Loop", "6.00", "5.50", "For-Loop", "5.84", "5.66", "Finish"]);
      // trainTheTrainers(["3", "Arrays", "4.53", "5.23", "5.00", "Lists", "5.83", "6.00", "5.42", "Finish"]);
      // trainTheTrainers(["2", "Objects and Classes", "5.77", "4.23", "Dictionaries", "4.62", "5.02", "RegEx", "2.88", "3.42", "Finish"]);

      // 06. Cinema Tickets

      function calcTicketTypes(data) {
        let movie = data[0];
        let stud = 0;
        let stan = 0;
        let kids = 0;
        let tickets = 0;
        let index = 0;
                
        while (movie !== "Finish") {
          index++;
          let seats = Number(data[index]);
          let totalTicketsForCurrentMovie = 0;
          
          for (let seat = 0; seat < seats; seat++) {
            index++;
            let input = data[index];

            if (input === "End") {
              break;
            }

            tickets++;
            totalTicketsForCurrentMovie++;
            
            switch (input) {
              case "student":
                stud++;
                break;
              case "standard":
                stan++;
                break;
              case "kid":
                kids++;
                break;
            }
          }

          const totalTicketsForCurrentMovieP = totalTicketsForCurrentMovie / seats * 100;
          console.log(`${movie} - ${totalTicketsForCurrentMovieP.toFixed(2)}% full.`);

          index++;
          movie = data[index];

        }

        const totalTicketsForStudP = stud / tickets * 100;
        const totalTicketsForStanP = stan / tickets * 100;
        const totalTicketsForKidsP = kids / tickets * 100;

        console.log(`Total tickets: ${tickets}`);
        console.log(`${totalTicketsForStudP.toFixed(2)}% student tickets.`);
        console.log(`${totalTicketsForStanP.toFixed(2)}% standard tickets.`);
        console.log(`${totalTicketsForKidsP.toFixed(2)}% kids tickets.`);

      }

      // calcTicketTypes(["Taxi", "10", "standard", "kid", "student", "student", "standard", "standard", "End", "Scary Movie", "6", "student", "student", "student", "student", "student", "student", "Finish"]);
      calcTicketTypes(["The Matrix", "20", "student", "standard", "kid", "kid", "student", "student", "standard", "student", "End", "The Green Mile", "17", "student", "standard", "standard", "student", "standard", "student", "End", "Amadeus", "3", "standard", "standard", "standard", "Finish"]);
    </script>
  </body>
</html>