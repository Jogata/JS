<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      // 09. Arena Tier✶

      function f1(params) {
        // console.log(params);
        let index = 0;

        if (params.length == 19) {
          if (params[15].length == 6) {     
            if (params[15].includes(" vs ")) {
              const data = params[15].split(" vs ");
              if (data.length == 2) {
                const ascii1 = params[15].charCodeAt(0);
                const ascii2 = params[15].charCodeAt(5);
                // console.log(ascii1);
                if (ascii2 > 64 && ascii2 < 70) {
                  // while (index < params.length) {
                    console.log(params[15]);
                  // index++;
                  // }
                }
              }        
            }
          }
        }
      }

      // 14 = "C vs D"
      // 15 = "E vs F"
      // ascii2 > 69 && ascii2 < 75 => F,G,H,I,J   / F
      // ascii1 > 64 && ascii1 < 70 => A,B,C,D,E   / E

      function f2(params) {
        // console.log(params);
        let index = 0;

        if (params.length == 19) {
          if (params[15].length == 6) {     
            if (params[15].includes(" vs ")) {
              const data = params[15].split(" vs ");
              if (data.length == 2) {
                const ascii1 = params[15].charCodeAt(0);
                const ascii2 = params[15].charCodeAt(5);
                console.log(ascii1);
                if (ascii1 == 69) {
                  while (index < params.length) {
                    console.log(params[15]);
                  // index++;
                  }
                }
              }
            }
          }
        }
      }

      function f3(params) {
        // console.log(params);
        let index = 0;

        if (params.length == 19) {
          if (params[15].length == 6) {     
            if (params[14] == "C vs D") {
              if (params[15] == "E vs F") {
              // const data = params[15].split(" vs ");
              // if (data.length == 2) {
                // const ascii1 = params[15].charCodeAt(0);
                // const ascii2 = params[15].charCodeAt(5);
                // console.log(ascii1);
                // if (ascii1 == 69) {
                  while (index < params.length) {
                    console.log(params[14]);
                    console.log(params[15]);
                  // index++;
                  }
                // }
              // }
              }
            }
          }
        }
      }

      function f5(params) {
        // console.log(params);
        let inf = 0;

        for (let index = 0; index < params.length; index++) {
          if (params[index].includes(" vs ")) {
            const ascii1 = params[index].charCodeAt(0);
            const ascii2 = params[index].charCodeAt(5);
            if (ascii1 > 96 && ascii1 < 123 ) {
              // console.log(ascii1);
              // console.log(params[index]);
              while (inf < params.length) {
                inf = 0;
              }
            }
          }
        }
      }

      function arenaFights(params) {
        const gladiators = {};
        let index = 0;
        let input = params[index];

        // if (params.length < 16) {
        //     return;
        // }
        
        while (input != "Ave Cesar") {
          // console.log(input);
          const data = input.split(" -> ");
          // console.log(data);

          if (!data) {
            while (true) {
              index++
            }
          }

          // if (index == 14) {
          //   break;
          // }

          // if (index == 14) {            
          //   if (data.length == 1) {
          //     if (typeof input == "string") {
          //       if (input.length == 6) {
          //         if (input.includes("c")) {
          //           // for (let index = 0; index < input.length; index++) {
          //           //   let ascii = input[index].charCodeAt(0);
          //           //   if (ascii > 100 && ascii < 107) {
          //           //     console.log(ascii);
          //           //     return;
          //           //   }
          //           // }
          //           // [" ", 65-70=C,D ,97-100=c,d]
          //           // console.log(input);
          //           break;
          //         }
          //       }
          //     }
          //   }
          // }

          // console.log(input);
          // if (input.startsWith("Ave Ce")) {
            // console.log("Ave Ce");
            // break;
          // }

          if (data.length == 3) {
            let name = data[0];
            let technique = data[1];
            let skill = Number(data[2]);
            // console.log(name);
            // console.log(technique);
            // console.log(skill);

            // if (!skill) {
            //   skill = 0;
            // }
            // if (!technique) {
            //   technique = "random";
            // }
            // if (!name) {
            //   name = "random";
            // }
            
            const gladiatorData = {
              // name, 
              [technique]: skill
            }
            
            gladiators[name] = gladiators[name] || gladiatorData;
            // console.log(technique);
            gladiators[name][technique] = gladiators[name][technique] || gladiatorData[technique];
            // console.log(gladiators[name][technique]);
            const higherValue = Math.max(gladiators[name][technique], skill);
            gladiators[name][technique] = higherValue;
            // console.log(higherValue);
          } else {
            const data = input.split(" vs ");

            if (data.length == 2) {
              const glad1 = data[0];
            const glad2 = data[1];
            // console.log(glad1, glad2);
            
            if (gladiators[glad1]) {
              if (gladiators[glad2]) {
                const glad1Techniques = Object.keys(gladiators[glad1]);
                const glad2Techniques = Object.keys(gladiators[glad2]);
                // console.log(glad1Techniques);
                // console.log(glad2Techniques);
                for (const glad1Technique of glad1Techniques) {
                  for (const glad2Technique of glad2Techniques) {
                    if (glad1Technique == glad2Technique) {
                      // console.log(glad1Technique);
                      // console.log(glad2Technique);
                      const glad1Skills = Object.values(gladiators[glad1]);
                      const glad2Skills = Object.values(gladiators[glad2]);
                      // console.log(glad1Skills);
                      // console.log(glad2Skills);
                      const glad1TotalSkills = glad1Skills.reduce((acc, skill) => {
                        return acc + skill;
                      }, 0);
                      // const glad2TotalSkills = glad2Skills.reduce((acc, skill) => {
                      //   return acc + skill;
                      // }, 0);
                      const glad2TotalSkills = glad2Skills.reduce((acc, skill) => acc + skill, 0);
                      // console.log(glad1TotalSkills);
                      // console.log(glad2TotalSkills);
                      // console.log("fight");
                      if (glad1TotalSkills > glad2TotalSkills) {
                        delete gladiators[glad2];
                      } else if (glad1TotalSkills < glad2TotalSkills) {
                        delete gladiators[glad1];
                      }
                    } 
                    // else {
                      // console.log(`${glad1} and ${glad2} don't have a common technique for now.`);
                    // }
                  }
                }
              } 
              // else {
                // console.log(`${glad2} doesnt exist`);
              // }
            } 
            // else {
              // console.log(`${glad1} doesnt exist`);
            // }
            }
          }
          
          index++;
          input = params[index];

          // if (index == 15) {
            // console.log("infinity");
            // console.log(index);
            // break;
            // input = "Ave Cesar";
            // console.log(input);
          // }
          // console.log(index, input);

          // if (!input) {
          //   while (true) {
          //     index++;
          //   }
          // }

        }

        const remainingGladiators = [];

        for (const gladiatorName in gladiators) {
          // console.log(gladiatorName);
          const gladSkills = Object.values(gladiators[gladiatorName]);
          const totalSkills = gladSkills.reduce((acc, skill) => {
            return acc + skill;
          }, 0);
          // gladiators[gladiator].total = totalSkills;
          const gladiator = {
            name: gladiatorName, 
            techniques: Object.entries(gladiators[gladiatorName]), 
            totalSkills
          }

          gladiator.techniques = gladiator.techniques.sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));

          remainingGladiators.push(gladiator);
        }

        // console.log(gladiators);
        // console.log(remainingGladiators);

        const sorted = remainingGladiators.sort((a, b) => b.totalSkills - a.totalSkills || a.name.localeCompare(b.name));

        // console.log(sorted);

        for (const gladiator of sorted) {
          console.log(`${gladiator.name}: ${gladiator.totalSkills} skill`);
          for (const technique of gladiator.techniques) {
            console.log(`- ${technique[0]} <!> ${technique[1]}`);
          }
        }

      }

      function arenaFights(params) {
        const gladiators = [];

        for (let index = 0; index < params.length; index++) {
          const input = params[index];
          if (input.includes(" -> ")) {
            const data = input.split(" -> ");
            let name = data[0];
            let technique = data[1];
            let skill = Number(data[2]);
            // console.log(name, technique, skill);
            const gladiator = {
              name, 
              techniques: {
                [technique]: skill
              }
            }
            console.log(gladiator);
            const index = gladiators
          } else if (input.includes(" vs ")) {
            const data = input.split(" vs ");
            const glad1 = data[0];
            const glad2 = data[1];
            console.log(glad1, glad2);
          }
        }
      }
      
      f(
        [
          '"" -> "" -> 550',
          'Alex -> PowerPunch -> 450',
          'Stefan -> Tiger -> 550', 
          'Peter -> BattleCry -> 450', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          "C vs D", 
          "E vs F", 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          // 'Stefan -> Tiger -> 300', 
          // 'Stefan -> Tiger -> 300', 
          // 'Stefan -> Tiger -> 300', 
          // 'Stefan -> Tiger -> 300', 
          // 'Stefan -> Tiger -> 300', 
          // 'Stefan -> Tiger -> 300', 
          // 'Stefan -> Tiger -> 600', 
          // 'Ave Ces', 
          // 'Ave Cesar'
        ]
      )
//       arenaFights(
//         [
//           'Peter -> Duck -> 400', 
//           'Julius -> Shield -> 150', 
//           'Gladius -> Heal -> 200', 
//           'Gladius -> Support -> 250', 
//           'Gladius -> Shield -> 250', 
//           'Peter vs Gladius', 
//           'Gladius vs Julius', 
//           'Jogata vs Julius', 
//           'Gladius vs Maximilian', 
//           'Julius -> Sh -> 150', 
//           'Julius -> Sh -> 250', 
//           'Julius -> S -> 250', 
//           'Ave Cesar'
//         ]
//       )
//       arenaFights(
// [
// 'Peter -> Duck -> 400',
// 'Julius -> Shield -> 150',
// 'Gladius -> Heal -> 200',
// 'Gladius -> Support -> 250',
// 'Gladius -> Shield -> 250',
// 'Peter vs Gladius',
// 'Gladius vs Julius',
// 'Gladius vs Maximilian',
// 'Ave Cesar']
// );

      // 10. Legendary Farming✶
    </script>
    <script>
      // 04. Movies

      function printMoviesInfo(params) {
      const movies = [];

      for (const input of params) {
        const data = input.split(" directedBy ");

        if (data.length > 1) {
          // console.log("directedBy");
          const movieName = data[0];
          const director = data[1];

          for (let index = 0; index < movies.length; index++) {
            const movie = movies[index];

            if (movie.name == movieName) {
              movie.director = director;
            }

          }
        } else {
          const data = input.split(" onDate ");

          if (data.length > 1) {
            // console.log("onDate");
            const movieName = data[0];
            const movieDate = data[1];

            for (let index = 0; index < movies.length; index++) {
            const movie = movies[index];

              if (movie.name == movieName) {
                movie.date = movieDate;
              }
            }
          } else {
            const data = input.split("addMovie ")
            // console.log(data);
            const movieName = data[1];

            const movie = {
              name: movieName
            }

            movies.push(movie);

          }

        }
      }

      for (const movie of movies) {
        if (movie.director && movie.date) {
          console.log(JSON.stringify(movie));
        }
      }

    }

    // printMoviesInfo(['addMovie Fast and Furious', 'addMovie Godfather', 'Inception directedBy Christopher Nolan', 'Godfather directedBy Francis Ford Coppola', 'Godfather onDate 29.07.2018', 'Fast and Furious onDate 30.07.2018', 'Batman onDate 01.08.2018', 'Fast and Furious directedBy Rob Cohen']);
    // printMoviesInfo(['addMovie The Avengers', 'addMovie Superman', 'The Avengers directedBy Anthony Russo', 'The Avengers onDate 30.07.2010', 'Captain America onDate 30.07.2010', 'Captain America directedBy Joe Russo']);

    // 05. Sequences

function printUniqueSequences(params) {
let result = [];

for (const input of params) {
const arr = JSON.parse(input);
// console.log(arr);
arr.sort((a, b) => b - a);
const str = arr.join(" ");
result.push(str);
}

// console.log(result);

for (let outher = 0; outher < result.length; outher++) {
const matches = [];

for (let inner = outher+1; inner < result.length; inner++) {
  // console.log(outher, inner);
  if (result[outher] == result[inner]) {
    matches.push(inner - matches.length);
    // console.log(outher, inner);
    // console.log(matches);
  }
}

// if (matches.length > 1) {
  // matches.unshift(outher);
  // console.log(matches);
// }

for (let index = 0; index < matches.length; index++) {
  result.splice(matches[index], 1);
  // console.log(result);
}
}

result = result.map(string => string.split(" "));
result.sort((x, y) => x.length - y.length);
// console.log(result);

for (const arr of result) {
  console.log(`[${arr.join(", ")}]`);
}

}

// printUniqueSequences(
// ["[-3, -2, -1, 0, 1, 2, 3, 4]",
// "[10, 1, -17, 0, 2, 13]",
// "[4, -3, 3, -2, 2, -1, 1, 0]",
// "[3, 3]",
// "[3, 3]",
// "[2, 2]",
// "[3, 3]",
// "[4, -3, 3, -2, 2, -1, 1, 0]"]
// );
// printUniqueSequences(
//   ["[7.14, 7.180, 7.339, 80.099]",
//   "[7.339, 80.0990, 7.140000, 7.18]",
//   "[7.339, 7.180, 7.14, 80.099]"]
// );

// 03. School Register

function createSchoolRegister(params) {
const grades = [];

for (const input of params) {
const data = input.split(", ");
// console.log(data);

const nameData = data[0].split(": ");
const name = nameData[1];
// console.log(name);
const gradeData = data[1].split(": ");
const grade = Number(gradeData[1]);
// console.log(grade);
const scoreData = data[2].split(": ");
const score = Number(scoreData[1]);
// console.log(score);

if (score >= 3) {
  const student = {
  name, 
  grade, 
  score
}

grades[grade] = grades[grade] || [];

grades[grade].push(student);
}

}

// console.log(grades);

for (let index = 0; index < grades.length; index++) {
// console.log(grades[index]);
if (grades[index]) {
  // const filtered = grades[index].filter(x => x.score >= 3);
  // console.log(filtered);
  // if (filtered.length > 0) {
    const sum = grades[index].reduce((acc, x) => {
    return acc + x.score;
  }, 0)

  // console.log(sum);

  const average = sum / grades[index].length;
  // console.log(average);
  const students = [];

  for (const student of grades[index]) {
    students.push(student.name);
  }
  // console.log(students);

  console.log(`${index+1} Grade`);
  console.log(`List of students: ${students.join(", ")}`);
  console.log(`Average annual score from last year: ${average.toFixed(2)}`);
  console.log();
  }
// }
}

}

// createSchoolRegister([
//   "Student name: Mark, Grade: 8, Graduated with an average score: 4.75",
//   "Student name: Ethan, Grade: 9, Graduated with an average score: 5.66",
//   "Student name: George, Grade: 8, Graduated with an average score: 2.83",
//   "Student name: Steven, Grade: 10, Graduated with an average score: 4.20",
//   "Student name: Joey, Grade: 9, Graduated with an average score: 4.90",  
//   "Student name: Angus, Grade: 11, Graduated with an average score: 2.90", 
//   "Student name: Bob, Grade: 11, Graduated with an average score: 5.15", 
//   "Student name: Daryl, Grade: 8, Graduated with an average score: 5.95", 
//   "Student name: Bill, Grade: 9, Graduated with an average score: 6.00", 
//   "Student name: Philip, Grade: 10, Graduated with an average score: 5.05", 
//   "Student name: Peter, Grade: 11, Graduated with an average score: 4.88", 
//   "Student name: Gavin, Grade: 10, Graduated with an average score: 4.00"
// ]);
// createSchoolRegister([
//   'Student name: George, Grade: 5, Graduated with an average score: 2.75', 
//   'Student name: Alex, Grade: 9, Graduated with an average score: 3.66',
//   'Student name: Peter, Grade: 8, Graduated with an average score: 2.83',
//   'Student name: Boby, Grade: 5, Graduated with an average score: 4.20',
//   'Student name: John, Grade: 9, Graduated with an average score: 2.90',
//   'Student name: Steven, Grade: 2, Graduated with an average score: 4.90',
//   'Student name: Darsy, Grade: 1, Graduated with an average score: 5.15'
// ]);

    // 5. Simple Calculator

    function setCalc(n1, n2, operation) {
      const operations = {
        multiply: multiply, 
        divide: divide, 
        add: add, 
        subtract: subtract
      }

      function multiply(n1, n2) {
        return n1 * n2;
      }

      function divide(n1, n2) {
        return n1 / n2;
      }

      function add(n1, n2) {
        return n1 + n2;
      }

      function subtract(n1, n2) {
        return n1 - n2;
      }

      let result = 0;

      result = operations[operation](n1, n2);

      console.log(result);

    }

    // setCalc(5, 5, 'multiply');
    // setCalc(40, 8, 'divide');
    // setCalc(12, 19, 'add');
    // setCalc(50, 13, 'subtract');
</script>
<script>
  // 01. Reveal Words

  function revealWords(params, phrase) {
    const words = params.split(", ");
    // console.log(words);
    // let result = "";

    for (const word of words) {
      // console.log(word);
      const length = word.length;
      // console.log(length);
      const splited = phrase.split(" ");
      const searched = "*".repeat(length);
      // console.log(searched);
      const index = splited.indexOf(searched);
      // console.log(index);
      if (index) {
        splited[index] = word;
      }
      phrase = splited.join(" ");
    }

    console.log(phrase);

  }

  // revealWords('great', 'softuni is ***** place for learning new programming languages');
  // revealWords('great, learning', 'softuni is ***** place for ******** new programming languages');

  // 02. Modern Times of #(HashTag)

  function findHashTags(phrase) {
    // console.log(phrase);
    const words = phrase.split(" ");
    // console.log(words);
    const filtered = words.filter(x => x.startsWith("#") && x.length > 1);
    // console.log(filtered);

    for (let word of filtered) {
      let isNumber = false;
      for (const letter of word) {
        // console.log(Number.parseInt(letter));
        // console.log(letter);
        if (Number.parseInt(letter)) {
          isNumber = true;
          // console.log(word);
          break;
        }
      }

      if (!isNumber) {
        word = word.replace("#", "");
        console.log(word);
      }
    }

  }

  // findHashTags('Nowadays everyone uses # to tag a #spec1ial word in #socialMedia');
  // findHashTags('The symbol # is known #variously in English-speaking #regions as the #number sign');

  // 03. Extract File

  function extractFile(path) {
    // console.log(path);
    const parts = path.split("\\");
    // console.log(parts);
    const file = parts[parts.length - 1];
    // console.log(file);
    const fileParts = file.split(".");
    // console.log(fileParts);
    let fileName = "";
    const ext = fileParts[fileParts.length - 1];
    // console.log(ext);

    for (let index = 0; index < fileParts.length - 2; index++) {
      let part = fileParts[index] + ".";
      fileName += part;
    }

    fileName += fileParts[fileParts.length - 2];

    console.log(`File name: ${fileName}`);
    console.log(`File extension: ${ext}`);

  }

  // extractFile("C:\\Internal\\training-internal\\Template.bss.pptx");
  // extractFile('C:\\Projects\\Data-Structures\\LinkedList.cs');

  // 04. String Substring

  function findString(searched, phrase) {
    // console.log(phrase);
    // console.log(searched);
    const words = phrase.split(" ");
    let isFound = false;

    for (const word of words) {
      if (searched.toLowerCase() == word.toLowerCase()) {
        isFound = true;
        break;
      }
    }

    if (isFound) {
      console.log(searched);
    } else {
      console.log(`${searched} not found!`);
    }

  }

  findString('javascript', 'JavaScript is the best programming language');
  findString('python', 'JavaScript is the best programming language');

  // 05. Replace Repeating Chars

  function replaceRepeatingChars(word) {
    // console.log(word);
    let current = word[0];
    let newWord = current;

    for (let index = 1; index < word.length; index++) {
      if (word[index] != current) {
        current = word[index];
        newWord += current;
      }
    }

    console.log(newWord);

  }

  function replaceRepeatingChars(word) {
    // console.log(word);
    
    for (let index = 0; index < word.length - 1; index++) {
      if (word[index] == word[index + 1]) {
        let current = word[index];
        const removed = current + current;
        word = word.replaceAll(removed, current);
        index = -1;
      }
      
    }
    // word = word.replaceAll("aa", "a");
    console.log(word);
    
  }

  replaceRepeatingChars('aaaaabbbbbcdddeeeedssaa');
  replaceRepeatingChars('qqqwerqwecccwd');

  // 06. Pascal-Case Splitter
  // 07. Cut and Reverse
  // 08. Hard Word✶
  // 09. Password Generator✶
  // 10. Letters Change Numbers✶
</script>
  </body>
</html>