<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
            // 03. Easter Trip

            function solveEasterTrip(params) {
        let dest = params[0];
        let date = params[1];
        let days = Number(params[2]);

        let price = 0;

        switch (dest) {
          case "France":
            switch (date) {
              case "21-23":
                price = 30;
                break;
              case "24-27":
                price = 35;
                break;
              case "28-31":
                price = 40;
                break;
            }
            break;
          case "Italy":
            switch (date) {
              case "21-23":
                price = 28;
                break;
              case "24-27":
                price = 32;
                break;
              case "28-31":
                price = 39;
                break;
            }
            break;
          case "Germany":
            switch (date) {
              case "21-23":
                price = 32;
                break;
              case "24-27":
                price = 37;
                break;
              case "28-31":
                price = 43;
                break;
            }
            break;
        }

        let total = price * days;
        console.log(`Easter trip to ${dest} : ${total.toFixed(2)} leva.`);
      }

      // solveEasterTrip(["Germany", "24-27", "5"]);
      // solveEasterTrip(["Italy", "21-23", "7"]);
      // solveEasterTrip(["France", "28-31", "8"]);

      // 03. Painting Eggs

      function solvePaintingEggs(params) {
        let size = params[0];
        let color = params[1];
        let partidi = Number(params[2]);

        let price = 0;

        switch (size) {
          case "Large":
            switch (color) {
              case "Red":
                price = 16;
                break;
              case "Green":
                price = 12;
                break;
              case "Yellow":
                price = 9;
                break;
            }
            break;
          case "Medium":
            switch (color) {
              case "Red":
                price = 13;
                break;
              case "Green":
                price = 9;
                break;
              case "Yellow":
                price = 7;
                break;
            }
            break;
          case "Small":
            switch (color) {
              case "Red":
                price = 9;
                break;
              case "Green":
                price = 8;
                break;
              case "Yellow":
                price = 5;
                break;
            }
            break;
        }

        let total = (price * partidi) * 0.65;
        console.log(`${total.toFixed(2)} leva.`);
      }

      // solvePaintingEggs(["Large", "Red", "7"]);
      // solvePaintingEggs(["Medium", "Green", "5"]);
      // solvePaintingEggs(["Small", "Yellow", "3"]);

            // 02. Easter Party

            function calcEasterParty(params) {
        let gosti = Number(params[0]);
        let kuvert = Number(params[1]);
        let budjet = Number(params[2]);

        let cake = budjet * 0.1;
        let total = gosti * kuvert;

        if (gosti < 10 ) {
          total = total
        } else if (gosti <= 15) {
          total = total * 0.85;
        } else if (gosti <= 20) {
          total = total * 0.80;
        } else if (gosti > 20) {
          total = total * 0.75;
        }

        total += cake;

        if (budjet >= total) {
          let diff = budjet - total;
          console.log(`It is party time! ${diff.toFixed(2)} leva left.`);
        } else {
          let diff = total - budjet;
          console.log(`No party! ${diff.toFixed(2)} leva needed.`);
        }
      }

      // calcEasterParty(["18", "30", "450"]);
      // calcEasterParty(["8", "25", "340"]);
      // calcEasterParty(["24", "35", "550"]);
      
    </script>
  </body>
</html>