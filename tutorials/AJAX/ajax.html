<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
  </head>
  <body>
 
    <main>
      <div class="box">
        <img src="./slides/348752785_505207435051669_8291971845639749599_n.jpg" alt="">
      </div>
      <div class="box">
        <img src="./slides/356798994_967012961190529_4412407967034851009_n.jpg" alt="">
      </div>
      <div class="box">
        <img src="./slides/356940129_1021872482095940_7163622879331713946_n.jpg" alt="">
      </div>
      <div class="box">
        <img src="./slides/358794262_2029410497404504_8220717208730657446_n.jpg" alt="">
      </div>
      <div class="box">
        <img src="./slides/361293658_1300947700520880_5496842987114781813_n.jpg" alt="">
      </div>
      <div class="box">
        <img src="./slides/363501547_634324178451363_8761577603587065923_n.jpg" alt="">
      </div>
      <div class="box">
        <img src="./slides/366450015_726469829245996_6761655007762136773_n.jpg" alt="">
      </div> 
      <div class="box">
        <img src="./slides/369600102_688341202630518_728054106325483819_n.jpg" alt="">
      </div> 
    </main>
 
    <script> 
      class Person {
        constructor(name, age) {
          this.name = name;
          this.age = age;
        }
        greet() {
          return "Hello, " + this.name;
        }
        get speak() {
          return "Hi, how are you?";
        }
        changeName(newName) {
          this.name = newName;
        }
        set changeName2(newName) {
          this.name = newName;
        }
        set personName(newName) {
          this.name = newName;
        }
        get personName() {
          return this.name;
        }
      } 
 
      const person1 = new Person("Elon", 52)
 
      console.log(person1.greet());
      console.log(person1.speak);
 
      person1.changeName("Jogata");
      person1.changeName2 = "Jogata2";
 
      console.log(person1.greet());
 
      console.log(person1.personName);
      person1.personName = "Jogata3";
      console.log(person1.personName);
    </script> 
 
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->
    <fieldset style="display: none;">
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset style="display: none;">
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <button id="btn">Navigate</button>
    <a href="#footer">Navigate</a>
    <div id="output"></div>

    <footer id="footer"></footer>

    <script>
      show("location.href:" + location.href);
      show("location.search:" + location.search);
      show("location.hash:" + location.hash);

      show("history.state:" + history.state);

      document.addEventListener("DOMContentLoaded", () => {
        // history.pushState(null, "title", "doesntexist.html");
        // history.replaceState();
        window.addEventListener("hashchange", hc);
        window.addEventListener("popstate", ps);

        document.getElementById("btn").addEventListener("click", c);
      })

      function hc(e) {
        show("hashchange");
      }

      function ps(e) {
        show("popstate");
      }

      function c(e) {
        show("clicked");
        e.preventDefault();
        let href = e.currentTarget.href;
        show(href);
      }

      function show(output) {
        let p = document.createElement("p");
        p.textContent = output;
        document.getElementById("output").appendChild(p);
        setTimeout(() => {
          document.getElementById("output").removeChild(p);
        }, 4000);
      }

      function calcWatchingTime(params) {
        const title = params[0];
        const seasons = Number(params[1]);
        const episods = Number(params[2]);
        let duration = Number(params[3]);

        duration = duration * 1.2;

        let total = episods * duration;
        total = total + 10;
        total = seasons * total;

        console.log(`Total time needed to watch the ${title} series is ${total} minutes.`);
      }
    </script>
  </body>
</html>