<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
  </head>
  <body>
    <script>
      // 06. Easter Decoration

      function avverageCost(params) {
        const clients = Number(params[0]);
        
        const basket = 1.50;
        const wreath = 3.80;
        const bunny = 7;

        let total = 0;
        let index = 0;

        for (let client = 0; client < clients; client++) {
          index++;
          let input = params[index];
          let pokupki = 0;
          let current = 0;
          
          while (input !== "Finish") {

            switch (input) {
              case "basket":
                pokupki++;
                current += basket;
                break;
              case "wreath":
                pokupki++;
                current += wreath;
                break;
              case "chocolate bunny":
                pokupki++;
                current += bunny;
                break;
            }

            index++;
            input = params[index];

        }

        if (pokupki % 2 === 0) {
          current = current * 0.8;
        }

        total += current;
        console.log(`You purchased ${pokupki} items for ${current.toFixed(2)} leva.`);
          
        }

        const average = total / clients;

        console.log(`Average bill per client is: ${average.toFixed(2)} leva.`);

      }

      // avverageCost(["2", "basket", "wreath", "chocolate bunny", "Finish", "wreath", "chocolate bunny", "Finish"]);
      // avverageCost(["1", "basket", "wreath", "chocolate bunny", "wreath", "basket", "chocolate bunny", "Finish"]);

      // 01. Tennis Equipment

      function calcTennisEquipmentCost(params) {
        const raketa = Number(params[0]);
        const raketi = Number(params[1]);
        const maratonki = Number(params[2]);

        const maratonka = raketa / 6;

        let total = raketi * raketa + maratonki * maratonka;

        const others = total * 0.2;

        total += others;

        console.log(`Price to be paid by Djokovic ${Math.floor(total / 8)}`);
        console.log(`Price to be paid by sponsors ${Math.ceil(total * 7 / 8)}`);

      }

      // calcTennisEquipmentCost(["850", "4", "2"]);
      // calcTennisEquipmentCost(["386", "7", "4"]);

      // 01. Basketball Equipment

      function calcBasketballEquipmentCost(params) {
        const taksa = Number(params[0]);

        const kecove = taksa * 0.6;

        const ekip = kecove * 0.8;

        const ball = ekip * 0.25;

        const acsessories = ball * 0.2;

        const total = taksa + kecove + ekip + ball + acsessories;

        console.log(total.toFixed(2));
      }

      // calcBasketballEquipmentCost(["320"]);
      // calcBasketballEquipmentCost(["550"]);

      // 02. Football Results

      function printsFootballResults(params) {
        let wins = 0;
        let lost = 0;
        let draw = 0;
        
        for (let index = 0; index < params.length; index++) {
          
          const current = params[index];

          if (current[0] > current[2]) {
            wins++;
          } else if (current[0] < current[2]) {
            lost++;
          } else {
            draw++;
          }
        }

        console.log(`Team won ${wins} games.`);
        console.log(`Team lost ${lost} games.`);
        console.log(`Drawn games: ${draw}`);
      }

      printsFootballResults(["3:1", "0:2", "0:0"]);
      printsFootballResults(["4:2", "0:3", "1:0"]);
      printsFootballResults(["0:2", "0:1", "3:3"]);

    </script>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>
  </body>
</html>