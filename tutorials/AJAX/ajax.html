<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      // 09. Arena Tier✶

      function arenaFights(params) {
        const gladiators = {};
        let index = 0;
        let input = params[index];
      
        while (input != "Ave Cesar") {
          const data = input.split(" -> ");
          // console.log(data);

          if (data.length == 3) {
            let name = data[0];
            let technique = data[1];
            let skill = Number(data[2]);
            // console.log(name);
            // console.log(technique);
            // console.log(skill);

            // if (!skill) {
            //   skill = 0;
            // }
            // if (!technique) {
            //   technique = "random";
            // }
            // if (!name) {
            //   name = "random";
            // }
            
            const gladiatorData = {
              // name, 
              [technique]: skill
            }
            
            gladiators[name] = gladiators[name] || gladiatorData;
            // console.log(technique);
            gladiators[name][technique] = gladiators[name][technique] || gladiatorData[technique];
            // console.log(gladiators[name][technique]);
            const higherValue = Math.max(gladiators[name][technique], skill);
            gladiators[name][technique] = higherValue;
            // console.log(higherValue);
          } else {
            const data = input.split(" vs ");
            const glad1 = data[0];
            const glad2 = data[1];
            // console.log(glad1, glad2);
            
            if (gladiators[glad1]) {
              if (gladiators[glad2]) {
                const glad1Techniques = Object.keys(gladiators[glad1]);
                const glad2Techniques = Object.keys(gladiators[glad2]);
                // console.log(glad1Techniques);
                // console.log(glad2Techniques);
                for (const glad1Technique of glad1Techniques) {
                  for (const glad2Technique of glad2Techniques) {
                    if (glad1Technique == glad2Technique) {
                      // console.log(glad1Technique);
                      // console.log(glad2Technique);
                      const glad1Skills = Object.values(gladiators[glad1]);
                      const glad2Skills = Object.values(gladiators[glad2]);
                      // console.log(glad1Skills);
                      // console.log(glad2Skills);
                      const glad1TotalSkills = glad1Skills.reduce((acc, skill) => {
                        return acc + skill;
                      }, 0);
                      // const glad2TotalSkills = glad2Skills.reduce((acc, skill) => {
                      //   return acc + skill;
                      // }, 0);
                      const glad2TotalSkills = glad2Skills.reduce((acc, skill) => acc + skill, 0);
                      // console.log(glad1TotalSkills);
                      // console.log(glad2TotalSkills);
                      // console.log("fight");
                      if (glad1TotalSkills > glad2TotalSkills) {
                        delete gladiators[glad2];
                      } else if (glad1TotalSkills < glad2TotalSkills) {
                        delete gladiators[glad1];
                      }
                    } 
                    // else {
                      // console.log(`${glad1} and ${glad2} don't have a common technique for now.`);
                    // }
                  }
                }
              } 
              // else {
                // console.log(`${glad2} doesnt exist`);
              // }
            } 
            // else {
              // console.log(`${glad1} doesnt exist`);
            // }
          }
          
          index++;
          input = params[index];

          if (index >= 14) {
            // console.log("infinity");
            // console.log(index);
            // break;
            input = "Ave Cesar";
            // console.log(input);
          }
        }

        const remainingGladiators = [];

        for (const gladiatorName in gladiators) {
          // console.log(gladiatorName);
          const gladSkills = Object.values(gladiators[gladiatorName]);
          const totalSkills = gladSkills.reduce((acc, skill) => {
            return acc + skill;
          }, 0);
          // gladiators[gladiator].total = totalSkills;
          const gladiator = {
            name: gladiatorName, 
            techniques: Object.entries(gladiators[gladiatorName]), 
            totalSkills
          }

          gladiator.techniques = gladiator.techniques.sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));

          remainingGladiators.push(gladiator);
        }

        // console.log(gladiators);
        // console.log(remainingGladiators);

        const sorted = remainingGladiators.sort((a, b) => b.totalSkills - a.totalSkills || a.name.localeCompare(b.name));

        // console.log(sorted);

        for (const gladiator of sorted) {
          console.log(`${gladiator.name}: ${gladiator.totalSkills} skill`);
          for (const technique of gladiator.techniques) {
            console.log(`- ${technique[0]} <!> ${technique[1]}`);
          }
        }

      }

      arenaFights(
        [
          '"" -> "" -> 550',
          'Alex -> PowerPunch -> 450',
          'Stefan -> Tiger -> 550', 
          'Peter -> BattleCry -> 450', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 300', 
          'Stefan -> Tiger -> 600', 
          'Ave Cesar'
        ]
      )
      // arenaFights(
      //   [
      //     'Peter -> Duck -> 400', 
      //     'Julius -> Shield -> 150', 
      //     'Gladius -> Heal -> 200', 
      //     'Gladius -> Support -> 250', 
      //     'Gladius -> Shield -> 250', 
      //     'Peter vs Gladius', 
      //     'Gladius vs Julius', 
      //     'Jogata vs Julius', 
      //     'Gladius vs Maximilian', 
      //     'Ave Cesar'
      //   ]
      // )

      // 10. Legendary Farming✶
    </script>
    <script>
      // 04. Movies

      function printMoviesInfo(params) {
      const movies = [];

      for (const input of params) {
        const data = input.split(" directedBy ");

        if (data.length > 1) {
          // console.log("directedBy");
          const movieName = data[0];
          const director = data[1];

          for (let index = 0; index < movies.length; index++) {
            const movie = movies[index];

            if (movie.name == movieName) {
              movie.director = director;
            }

          }
        } else {
          const data = input.split(" onDate ");

          if (data.length > 1) {
            // console.log("onDate");
            const movieName = data[0];
            const movieDate = data[1];

            for (let index = 0; index < movies.length; index++) {
            const movie = movies[index];

              if (movie.name == movieName) {
                movie.date = movieDate;
              }
            }
          } else {
            const data = input.split("addMovie ")
            // console.log(data);
            const movieName = data[1];

            const movie = {
              name: movieName
            }

            movies.push(movie);

          }

        }
      }

      for (const movie of movies) {
        if (movie.director && movie.date) {
          console.log(JSON.stringify(movie));
        }
      }

    }

    // printMoviesInfo(['addMovie Fast and Furious', 'addMovie Godfather', 'Inception directedBy Christopher Nolan', 'Godfather directedBy Francis Ford Coppola', 'Godfather onDate 29.07.2018', 'Fast and Furious onDate 30.07.2018', 'Batman onDate 01.08.2018', 'Fast and Furious directedBy Rob Cohen']);
    // printMoviesInfo(['addMovie The Avengers', 'addMovie Superman', 'The Avengers directedBy Anthony Russo', 'The Avengers onDate 30.07.2010', 'Captain America onDate 30.07.2010', 'Captain America directedBy Joe Russo']);

    // 05. Sequences

function printUniqueSequences(params) {
let result = [];

for (const input of params) {
const arr = JSON.parse(input);
// console.log(arr);
arr.sort((a, b) => b - a);
const str = arr.join(" ");
result.push(str);
}

// console.log(result);

for (let outher = 0; outher < result.length; outher++) {
const matches = [];

for (let inner = outher+1; inner < result.length; inner++) {
  // console.log(outher, inner);
  if (result[outher] == result[inner]) {
    matches.push(inner - matches.length);
    // console.log(outher, inner);
    // console.log(matches);
  }
}

// if (matches.length > 1) {
  // matches.unshift(outher);
  // console.log(matches);
// }

for (let index = 0; index < matches.length; index++) {
  result.splice(matches[index], 1);
  // console.log(result);
}
}

result = result.map(string => string.split(" "));
result.sort((x, y) => x.length - y.length);
// console.log(result);

for (const arr of result) {
  console.log(`[${arr.join(", ")}]`);
}

}

// printUniqueSequences(
// ["[-3, -2, -1, 0, 1, 2, 3, 4]",
// "[10, 1, -17, 0, 2, 13]",
// "[4, -3, 3, -2, 2, -1, 1, 0]",
// "[3, 3]",
// "[3, 3]",
// "[2, 2]",
// "[3, 3]",
// "[4, -3, 3, -2, 2, -1, 1, 0]"]
// );
// printUniqueSequences(
//   ["[7.14, 7.180, 7.339, 80.099]",
//   "[7.339, 80.0990, 7.140000, 7.18]",
//   "[7.339, 7.180, 7.14, 80.099]"]
// );

// 03. School Register

function createSchoolRegister(params) {
const grades = [];

for (const input of params) {
const data = input.split(", ");
// console.log(data);

const nameData = data[0].split(": ");
const name = nameData[1];
// console.log(name);
const gradeData = data[1].split(": ");
const grade = Number(gradeData[1]);
// console.log(grade);
const scoreData = data[2].split(": ");
const score = Number(scoreData[1]);
// console.log(score);

if (score >= 3) {
  const student = {
  name, 
  grade, 
  score
}

grades[grade] = grades[grade] || [];

grades[grade].push(student);
}

}

// console.log(grades);

for (let index = 0; index < grades.length; index++) {
// console.log(grades[index]);
if (grades[index]) {
  // const filtered = grades[index].filter(x => x.score >= 3);
  // console.log(filtered);
  // if (filtered.length > 0) {
    const sum = grades[index].reduce((acc, x) => {
    return acc + x.score;
  }, 0)

  // console.log(sum);

  const average = sum / grades[index].length;
  // console.log(average);
  const students = [];

  for (const student of grades[index]) {
    students.push(student.name);
  }
  // console.log(students);

  console.log(`${index+1} Grade`);
  console.log(`List of students: ${students.join(", ")}`);
  console.log(`Average annual score from last year: ${average.toFixed(2)}`);
  console.log();
  }
// }
}

}

// createSchoolRegister([
//   "Student name: Mark, Grade: 8, Graduated with an average score: 4.75",
//   "Student name: Ethan, Grade: 9, Graduated with an average score: 5.66",
//   "Student name: George, Grade: 8, Graduated with an average score: 2.83",
//   "Student name: Steven, Grade: 10, Graduated with an average score: 4.20",
//   "Student name: Joey, Grade: 9, Graduated with an average score: 4.90",  
//   "Student name: Angus, Grade: 11, Graduated with an average score: 2.90", 
//   "Student name: Bob, Grade: 11, Graduated with an average score: 5.15", 
//   "Student name: Daryl, Grade: 8, Graduated with an average score: 5.95", 
//   "Student name: Bill, Grade: 9, Graduated with an average score: 6.00", 
//   "Student name: Philip, Grade: 10, Graduated with an average score: 5.05", 
//   "Student name: Peter, Grade: 11, Graduated with an average score: 4.88", 
//   "Student name: Gavin, Grade: 10, Graduated with an average score: 4.00"
// ]);
// createSchoolRegister([
//   'Student name: George, Grade: 5, Graduated with an average score: 2.75', 
//   'Student name: Alex, Grade: 9, Graduated with an average score: 3.66',
//   'Student name: Peter, Grade: 8, Graduated with an average score: 2.83',
//   'Student name: Boby, Grade: 5, Graduated with an average score: 4.20',
//   'Student name: John, Grade: 9, Graduated with an average score: 2.90',
//   'Student name: Steven, Grade: 2, Graduated with an average score: 4.90',
//   'Student name: Darsy, Grade: 1, Graduated with an average score: 5.15'
// ]);

    // 5. Simple Calculator

    function setCalc(n1, n2, operation) {
      const operations = {
        multiply: multiply, 
        divide: divide, 
        add: add, 
        subtract: subtract
      }

      function multiply(n1, n2) {
        return n1 * n2;
      }

      function divide(n1, n2) {
        return n1 / n2;
      }

      function add(n1, n2) {
        return n1 + n2;
      }

      function subtract(n1, n2) {
        return n1 - n2;
      }

      let result = 0;

      result = operations[operation](n1, n2);

      console.log(result);

    }

    // setCalc(5, 5, 'multiply');
    // setCalc(40, 8, 'divide');
    // setCalc(12, 19, 'add');
    // setCalc(50, 13, 'subtract');
</script>
  </body>
</html>