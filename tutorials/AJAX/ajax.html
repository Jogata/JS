<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <style>
      @import url(https://fonts.googleapis.com/css?family=Open+Sans);
input[type=text] {
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}
input[type=button] {
    background-color: #4CAF50;
    color: white;
    padding: 10px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
input[type=button]:hover {
    background-color: #45a049;
}
body {
    margin: auto;
    width: 25%;
    text-align: center;
    padding: 20px;
    font-family: 'Open Sans', serif;
}
#stopName {
    font-size: 1.5em;
    margin: 8px 0;
    font-weight: 400;
    padding: 0.25em;
    border-radius: 4px;
    background-color: aquamarine;
}
    </style>
  </head>
  <body>
    <!-- <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1> -->

<script>
  // 10. Contacts Builder✶
  // 11. View Model✶
  // 12. Payment Package
  // 13. String Builder *✶
</script>

    <!-- ================= Get data from local JSON file ================= -->

    <script>
      console.log("Hello");
  
      const p = new Promise(executor);
      // p.then(onSuccess, onError);
      p.then(onSuccess).catch(onError);
  
      console.log("there");
  
      function executor(resolve, reject) {
          console.log("executing started");
          // resolve("Bye!");
          // setTimeout(resolve, 2000, "Bye!");
          setTimeout(() => {
              reject("Bye!");
          }, 2000);
      }
  
      function onSuccess(data) {
          console.log(data);
      }
  
      function onError(err) {
          console.log(err);
      }
    </script>
      
    <script>
      // start1();

      async function start1() {
          const r1 = await execute1();
          const r2 = await execute2();
          const r3 = await execute3();
          console.log(r1, r2, r3);
      }

      start2();
      async function start2() {
          const r1 = execute1();
          const r2 = execute2();
          const r3 = execute3();
          console.log(await r1, await r2, await r3);
      }

      function execute1() {
          console.log("execute 1");
          return new Promise(res => {
              setTimeout(res, 1500, "result 1");
          })
      }

      function execute2() {
          console.log("execute 2");
          return new Promise(res => {
              setTimeout(res, 1000, "result 2");
          })
      }

      function execute3() {
          console.log("execute 3");
          return new Promise(res => {
              setTimeout(res, 2000, "result 3");
          })
      }
    </script>

<div id="stopInfo" style="width:20em">
  <div>
      <label for="stopId">Stop ID: </label>
      <input id="stopId" type="text">
      <input id="submit" type="button" value="Check" onclick="getInfo()"></div>
  <div id="result">
      <div id="stopName"></div>
      <ul id="buses"></ul>
  </div>
</div>

    <script>
      function getInfo() {
    // console.log("TODO...");
    const busStopInput = document.getElementById("stopId");
    const ID = busStopInput.value;
    const url = "http://localhost:3030/jsonstore/bus/businfo/";

    const busesOutput = document.getElementById("buses");
    busesOutput.textContent = "";

    fetch(`${url}${ID}`)
        // .then(response => {
            // console.log(response);
            // return response;
        // })
        .then(response => {
            if (!response.ok) {
                return;
            }
            const data = response.json();
            // console.log(data);
            return data;
        })
        .then(data => {
            // console.log(data);
            const stopOutput = document.getElementById("stopName");
            stopOutput.textContent = data.name;
            // const busesOutput = document.getElementById("buses");
            // busesOutput.textContent = "";
            const busesInfo = Object.entries(data.buses);
            // console.log(busesInfo);
            for (const bus of busesInfo) {
                const id = bus[0];
                const time = bus[1];
                // console.log(id, time);
                const li = document.createElement("li");
                li.textContent = `Bus ${id} arrives in ${time} minutes`;
                busesOutput.appendChild(li);
            }
        })
        .catch(err => {
            const stopOutput = document.getElementById("stopName");
            stopOutput.textContent = "Error";
        });


    // fetch(url)
    //     .then(response => {
    //         console.log(response);
    //         return response;
    //     })
    //     .then(response => {
    //         const data = response.json();
    //         console.log(data);
    //         return data;
    //     })
    //     .then(data => console.log(data));
}
    </script>

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      const matches4 = `
      40 Desert Blade (Fragment)
40 Minotaur's Head (Fragment)
40 Diviner's Orb - Recipe (Fragment)
50 Panoptic Orb - Recipe (Fragment)
80 Hand of Glory (Fragment)

40 Book of Prophecies - Recipe (Fragment)
50 Book of Fate - Recipe (Fragment)
80 Flaming Heart (Fragment)
160 Pastor's Seal (Fragment)

80 Riversar's Tiara (Fragment)
`;
      const matches3 = `740/120/100      640/320/150`;

const patern = /[0-9]+/g;

const result = matches3.match(patern).reduce((acc, n) => acc + Number(n), 0);
console.log(result);
    </script>
  </body>
</html>