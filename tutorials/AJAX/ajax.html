<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      // Цената на един литър гориво е 2.10 лв.
      // Цената за екскурзовод е 100лв.
      // В зависимост от деня има отстъпки от общата цена - за събота 10%, а за неделя 20%

      function safari(params) {
        const budget = Number(params[0]);
        const fuelL = Number(params[1]);
        const weekDay = params[2];

        const guide = 100;
        const priceFuel = 2.1;

        let total = fuelL * priceFuel + guide;

        if (weekDay == "Saturday") {
          total = total * 0.9;
        } else if (weekDay == "Sunday") {
          total = total * 0.8;
        }

        if (budget >= total) {
          const diff = budget - total;
          console.log(`Safari time! Money left: ${diff.toFixed(2)} lv.`);
        } else {
          const diff = total - budget;
          console.log(`Not enough money! Money needed: ${diff.toFixed(2)} lv.`);
        }

      } 

      // safari(["1000", "10", "Sunday"]);
      // safari(["120", "30", "Saturday"]);

      // 06. Movie Tickets

      function generateMovieTicketsSN(params) {
        const n1 = Number(params[0]);
        const n2 = Number(params[1]);
        const n3 = Number(params[2]);

        let sn = "";

        for (let s1i = n1; s1i < n2; s1i++) {

          const s1ASCII = String.fromCharCode(s1i);
          const s4 = s1ASCII.charCodeAt(s1ASCII);
          let s2 = 1;
          let s3 = 1;

          if (s4 % 2 === 0) {
            continue;
          } 
          // else {
          //   console.log(s1ASCII);
          // }

          for (s2 = 1; s2 < n3; s2++) {

            // console.log(s2);

            for (s3 = 1; s3 <= n3/2 - 1; s3++) {

              // console.log(s3);
              
              let sum = s2 + s3 + s4;
    
              // console.log(sum);
    
              if (sum % 2 !== 0) {
                sn = `${s1ASCII}-${s2}${s3}${s4}`;
                console.log(sn);
              }

            }

          }

        }

      }

      // generateMovieTicketsSN(["86", "88", "4"]);
      // generateMovieTicketsSN(["71", "74", "6"]);
      // generateMovieTicketsSN(["69", "72", "4"]);
      // generateMovieTicketsSN(["73", "91", "7"]);
    </script>
  </body>
</html>