<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
  </head>
  <body style="font-family: Georgia">
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <div id="output">
      <!-- results goes here -->
    </div>

    <script>
      const root = "https://jsonplaceholder.typicode.com/";
      let uri = root + "posts/?userId=1";

      console.log(uri);

      let options = {
        method: "GET", 
        mode: 'no-cors'
      }

      let formdata = new FormData();

      formdata.append("userid", 3);
      formdata.append("title", "Some Title");
      formdata.append("body", "Some Text");

      let options2 = {
        method: "POST", 
        mode: "no-cors", 
        body: formdata
      }

      let req = new Request(uri, options);
      let req2 = new Request(uri, options2);

      fetch(uri)
        .then(response => {
          console.log(response);
          if (response.ok) {
            // console.log(response);
            return response.json();
          } else {
            throw new Error("Bad HTTP");
          }
        })
        .then(data => {
          console.log(data);
        })
        .catch(err => {
          console.log("ERROR: ", err.message);
        })
    </script>

    <p>
      <button id="btn">button</button>
    </p>
    <p>
      <a href="https://www.google.com" id="lnk">google</a>
    </p>
    <p>
      <input type="text" name="" id="txt">
    </p>
    <script>
      const btn = document.getElementById("btn");
      const lnk = document.getElementById("lnk");
      const txt = document.getElementById("txt");

      btn.addEventListener("click", buttonClicked);

      function buttonClicked(e) {
        console.log(e.type);
        console.log(e.target);
        console.log(e.currentTarget);
      }

      lnk.addEventListener("click", linkClicked);

      function linkClicked(e) {
        e.preventDefault();
        console.log(e.type);
        console.log(e.target);
        console.log(e.currentTarget);
      }

      txt.addEventListener("click", inputClicked);

      txt.addEventListener("input", (e) => {
        console.log(e.type);
        console.log(e.target.value);
      });

      txt.addEventListener("change", (e) => {
        console.log(e.type);
      });

      txt.addEventListener("blur", (e) => {
        console.log(e.type);
      });

      function inputClicked(e) {
        console.log(e.type);
        console.log(e.target);
        console.log(e.currentTarget);
      }

      txt.addEventListener("keydown", keyDown);

      function keyDown(e) {
        let target = e.currentTarget;
        let tag = target.tagName;
        let key = e.char || e.charCode || e.which;
        let key2 = e.key;
        console.log(key, String.fromCharCode(key));
        console.log(key2);
        if (key === 37) {
          console.log("LEFT");
        }
      }

      document.body.addEventListener("keydown", keyDown);
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", init);
      function init() {
        if (navigator.geolocation) {
        } else {}
      }
    </script>
  </body>
</html>