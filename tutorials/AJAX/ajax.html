<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

<script>
  // 06. Name Game

  function playNameGame(params) {
    let index = 0;
    let input = params[index];
    let max = 0;
    let winner = "";

    while (input !== "Stop") {
      let name = input;
      let sum = 0;

      for (let i = 0; i < name.length; i++) {
        let letter = name[i];
        index++;
        input = Number(params[index]);

        // console.log(input);
        
        if (input === letter.charCodeAt(0)) {
          sum += 10;
        } else {
          sum += 2;
        }
      }

      if (sum >= max) {
        max = sum;
        winner = name;
      }

      index++;
      input = params[index];

      // if (index > 20) {
      //   console.log("inf");
      //   break;
      // }
    }

    console.log(`The winner is ${winner} with ${max} points!`);

  }

  // playNameGame(["Ivan", "73", "20", "98", "110", "Ivo", "80", "65", "87", "Stop"]);
  // playNameGame(["Pesho", "124", "34", "111", "97", "99", "Gosho", "98", "124", "88", "76", "18", "Stop"]);

  // 05. Football Tournament

  function menageFootballTeamStatistics(params) {
    const team = params[0];
    const sreshti = Number(params[1]);
    let points = 0;
    let wins = 0;
    let ravni = 0;
    let loses = 0;

    if (sreshti === 0) {
      console.log(`${team} hasn't played any games during this season.`);
      return;
    }

    for (let sreshta = 1; sreshta <= sreshti; sreshta++) {
      let result = params[sreshta+1];

      // console.log(result);

      if (result == "W") {
        wins++;
        points += 3;
      } else if (result == "D") {
        ravni++;
        points += 1;
      } else if (result == "L") {
        loses++;
      }

    }

    const winRate = wins / sreshti * 100;

    console.log(`${team} has won ${points} points during this season.`);
    console.log("Total stats:");
    console.log(`## W: ${wins}`);
    console.log(`## D: ${ravni}`);
    console.log(`## L: ${loses}`);
    console.log(`Win rate: ${winRate.toFixed(2)}%`);

  }

  // menageFootballTeamStatistics(["Liverpool", "10", "W", "D", "D", "W", "L", "W", "D", "D", "W", "W"]);
  // menageFootballTeamStatistics(["Barcelona", "7", "W", "D", "L", "L", "W", "W", "D"]);
  // menageFootballTeamStatistics(["Chelsea", "0"]);

  // 02. Family Trip

  // Бюджетът, с който разполагат – реално число в интервала [1.00 … 10000.00]
  // Брой нощувки – цяло число в интервала [0 … 1000]
  // Цена за нощувка – реално число в интервала [1.00 … 500.00]
  // Процент за допълнителни разходи – цяло число в интервала [0 … 100]

  function calcFamilyTrip(params) {
    const budget = Number(params[0]);
    const noshti = Number(params[1]);
    let price = Number(params[2]);
    const percentAE = Number(params[3]);

    if (noshti > 7) {
      price = price * 0.95;
    }

    let total = noshti * price + budget * (percentAE / 100);

    if (budget >= total) {
      const diff = budget - total;
      console.log(`Ivanovi will be left with ${diff.toFixed(2)} leva after vacation.`);
    } else {
      const diff = total - budget;
      console.log(`${diff.toFixed(2)} leva needed.`);
    }
  }

  // calcFamilyTrip(["800.50", "8", "100", "2"]);
  // calcFamilyTrip(["500", "7", "66", "15"]);
</script>
  </body>
</html>