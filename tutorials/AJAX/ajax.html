<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      // 05. Special Numbers

      function findSpecialNumbers(data) {
        const n = Number(data[0]);
        let result = "";

        for (let number = 1111; number < 9999; number++) {
          let current = number.toString();

          for (let letter = 0; letter < current.length; letter++) {
            let symbol = Number(current[letter]);

            if (n % symbol !== 0) {
              current = false;
              break;
            }
          }

          if (current) {
            result = result + `${current} `
          }

        }

        console.log(result);
      }

      // findSpecialNumbers(["3"]);
      // findSpecialNumbers(["11"]);

      // 01. Birthday Party

      function calcBirthdayParty(data) {
        const rent = Number(data[0]);
        let cake = rent * 0.2;
        let drinks = cake * 0.55;
        let anime = rent / 3;

        let sum = rent + cake + drinks + anime;

        console.log(sum);
      }

      // calcBirthdayParty(["2250"]);
      // calcBirthdayParty(["3720"]);

      // 02. Cat Walking

      function calcCatWalking(data) {
        const minutes = Number(data[0]);
        const hikes = Number(data[1]);
        const calories = Number(data[2]);

        const burnedcal = hikes * minutes * 5;

        if (burnedcal >= (calories / 2)) {
          console.log(`Yes, the walk for your cat is enough. Burned calories per day: ${burnedcal}.`);
        } else {
          console.log(`No, the walk for your cat is not enough. Burned calories per day: ${burnedcal}.`);
        }
      }

      // calcCatWalking(["30", '3', "600"]);
      // calcCatWalking(["15", '2', "500"]);
      // calcCatWalking(["40", '2', "200"]);

      // 03. Energy Booster

      function calcEnergyBoosterPrice(data) {
        const flavor = data[0];
        let razfasofka = data[1];
        const q = Number(data[2]);
        let price = 0;

        if (razfasofka === "small") {
          razfasofka = 2;
          switch (flavor) {
            case "Watermelon":
              price = 56;
              break;
            case "Mango":
              price = 36.66;
              break;
            case "Pineapple":
              price = 42.10;
              break;
            case "Raspberry":
              price = 20;
              break;
          }
        } else {
          razfasofka = 5;
          switch (flavor) {
            case "Watermelon":
              price = 28.7;
              break;
            case "Mango":
              price = 19.60;
              break;
            case "Pineapple":
              price = 24.80;
              break;
            case "Raspberry":
              price = 15.20;
              break;
          }
        }

        let sum = q * price * razfasofka;

        if (sum >= 400 && sum <= 1000) {
          sum = sum * 0.85;
        } else if (sum > 1000) {
          sum /= 2;
        }

        console.log(`${sum.toFixed(2)} lv.`);
      }

      // calcEnergyBoosterPrice(["Watermelon", "big", "4"]);
      // calcEnergyBoosterPrice(["Pineapple", "small", "1"]);
      // calcEnergyBoosterPrice(["Raspberry", "small", "50"]);
      // calcEnergyBoosterPrice(["Mango", "big", "8"]);

      // 04. Food for Pets

      function calcPetsFood(data) {
        const days = Number(data[0]);
        const food = Number(data[1]);

        let dog = 0;
        let cat = 0;
        let bisc = 0;
        let currentDay = 0;

        for (let index = 2; index < data.length; index+=2) {
          dog = dog + Number(data[index]);
          cat = cat + Number(data[index+1]);
          currentDay++;

          if (currentDay % 3 === 0) {
            bisc += (Number(data[index]) + Number(data[index+1])) * 0.1;
          }
        }

        console.log(`Total eaten biscuits: ${Math.round(bisc)}gr.`);
        console.log(`${((cat + dog) / food * 100).toFixed(2)}% of the food has been eaten.`);
        console.log(`${(dog / (cat + dog) * 100).toFixed(2)}% eaten from the dog.`);
        console.log(`${(cat / (cat + dog) * 100).toFixed(2)}% eaten from the cat.`);
      }

      calcPetsFood(["3", "1000", "300", "20", "100", "30", "110", "40"]);
      calcPetsFood(["3", "500", "100", "30", "110", "25", "120", "35"]);
    </script>
  </body>
</html>