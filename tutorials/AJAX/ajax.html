<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
        // 03. Logistics

  // До 3 тона – микробус (200 лева на тон)
  // От 4 до 11 тона – камион (175 лева на тон)
  // 12 и повече тона – влак (120 лева на тон)

  function calcTransportCosts(arr) {
      const cargos = Number(arr[0]);

      let bus = 0;
      let truck = 0;
      let train = 0;
      let totalCargo = 0;

      for (let i = 1; i <= cargos; i++) {
          const cargo = Number(arr[i]);

          if (cargo <= 3) {
              bus += cargo;
          } else if (cargo <= 11) {
              truck += cargo;
          } else if (cargo > 11) {
              train += cargo;
          }
      }

      totalCargo = bus + truck + train;
      const totalCargoCost = bus * 200 + truck * 175 + train * 120;
      const averageCargoCost = totalCargoCost / totalCargo;
      const busP = bus / totalCargo * 100;
      const truckP = truck / totalCargo * 100;
      const trainP = train / totalCargo * 100;

      console.log(averageCargoCost.toFixed(2));
      console.log(`${busP.toFixed(2)}%`);
      console.log(`${truckP.toFixed(2)}%`);
      console.log(`${trainP.toFixed(2)}%`);
  }

  // calcTransportCosts(["4", "1", "5", "16", "3"]);
  // calcTransportCosts(["5", "2", "10", "20", "1", "7"]);

  // 06. Bills

  function calcMonthBills(arr) {
    const months = Number(arr[0]);

    let electricity = 0;
    const water = 20;
    const internet = 15;
    let others = 0;

    let electricityTotal = 0;
    let othersTotal = 0;

    for (let i = 1; i < arr.length; i++) {
      electricity = Number(arr[i]);
      electricityTotal += electricity;
      
      others = (electricity + water + internet) * 1.2;
      othersTotal += others;
    }

    const waterTotal = water * months;
    const internetTotal = internet * months;
    const average = (electricityTotal + waterTotal + internetTotal + othersTotal) / months;

    console.log(`Electricity: ${electricityTotal.toFixed(2)} lv`);
    console.log(`Water: ${waterTotal.toFixed(2)} lv`);
    console.log(`Internet: ${internetTotal.toFixed(2)} lv`);
    console.log(`Other: ${othersTotal.toFixed(2)} lv`);
    console.log(`Average: ${average.toFixed(2)} lv`);
  }

  // calcMonthBills(["5", "68.63", "89.25", "132.53", "93.53", "63.22"]);
  // calcMonthBills(["8", "123.54", "231.54", "140.23", "100", "122.4", "430", "178.52", "64.2"]);

  // 07. Football League

  function calcFens(arr) {
    const stad = Number(arr[0]);
    const fens = Number(arr[1]);
    
    let a = 0;
    let b = 0;
    let v = 0;
    let g = 0;

    for (let i = 0; i <arr.length; i++) {
      const sector = arr[i];
      
      switch (sector) {
        case "A":
          a++;
          break;
        case "B":
          b++;
          break;
        case "V":
          v++;
          break;
        case "G":
          g++;
          break;
      }
    }

    const aP = a / fens * 100;
    const bP = b / fens * 100;
    const vP = v / fens * 100;
    const gP = g / fens * 100;
    const fensP = fens / stad * 100;

    console.log(`${aP.toFixed(2)}%`);
    console.log(`${bP.toFixed(2)}%`);
    console.log(`${vP.toFixed(2)}%`);
    console.log(`${gP.toFixed(2)}%`);
    console.log(`${fensP.toFixed(2)}%`);
  }

  // calcFens(["76", "10", "A", "V", "V", "V", "G", "B", "A", "V", "B", "B"]);
  // calcFens(["93", "16", "A", "V", "G", "G", "B", "B", "G", "B", "A", "B", "B", "B", "A", "B", "B", "A"]);
  // calcFens(["1000", "12", "A", "A", "V", "V", "A", "G", "A", "A", "V", "G", "V", "A"]);

  // console.log("204");
    </script>
  </body>
</html>
