<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <h1>mutation observer</h1>

    <ul class="oldClassName">
      <li>list item 1.1</li>
      <li>
        list item 1.2
        <ul>
          <li>list item 2.1</li>
          <li>list item 2.2</li>
        </ul>
      </li>
      <li>list item 1.3</li>
    </ul>
    <script>
      const list = document.querySelector("ul");

      // Making a new MutationObserver object

      const observer = new MutationObserver(mutations => {
        console.log(mutations);
        mutations.forEach(record => {
          console.log(record);

          if (record.type === "attributes") {
            const name = record.attributeName;
            const oldValue = record.oldValue;
            const newValue = record.target.getAttribute(name);
            console.log("=======================");
            console.log(name);
            console.log(oldValue);
            console.log(newValue);
            console.log("=======================");
          } else if (record.type === "childList") {
            const removed = record.removedNodes.length;
            const addded = record.addedNodes.length;
            // const newValue = record.target.getAttribute(name);
            console.log("=======================");
            console.log(`Removed ${removed}`);
            console.log(`Added ${addded}`);
            // console.log(newValue);
            console.log("=======================");
          } else if (record.type === "characterData") {
            const oldValue = record.oldValue;
            const newValue = record.target.nodeValue;
            // const newValue = record.target.getAttribute(name);
            console.log("=======================");
            console.log(`Before: ${oldValue}`);
            console.log(`After: ${newValue}`);
            // console.log(newValue);
            console.log("=======================");
          }

          if (record.addedNodes.length > 0 && record.addedNodes[0].nodeType === Node.TEXT_NODE) {
            console.log(`From <${record.removedNodes[0].nodeValue}> 
            to <${record.addedNodes[0].nodeValue}>.`);
          }

        })
      });

      // Tell it what to observe

      // Attributes
      // observer.observe(list, {
      //   attributes: true,
      //   attributeFilter: ["class"],
      //   attributeOldValue: true,
      // })

      // setTimeout(() => {
      //   list.setAttribute("id", "listIDadded");
      //   list.setAttribute("class", "newClassName");
      // }, 1000);

      // Child nodes
      // observer.observe(list, {
      //   childList: true,
      // })

      // setTimeout(() => {
      //   list.removeChild(list.firstElementChild);

      //   const li = document.createElement("li");
      //   li.textContent = "new list item 1.1.2";
      //   list.appendChild(li);
      // }, 1000);

      // Text
      // observer.observe(list.firstElementChild, {
      //   childList: true,
      // })

      // setTimeout(() => {
      //   list.firstElementChild.textContent = "new list item 1.1.2";
      // }, 1000);

      // Text
      observer.observe(list.firstElementChild.firstChild, {
        characterData: true,
        characterDataOldValue: true,
      })

      setTimeout(() => {
        list.firstElementChild.firstChild.textContent = "new list item 1.1.2";
      }, 1000);

    </script>

    <script>
      // 05. Average Number

      function calcAverageNumber(numbers) {
        let index = 1;
        let sum = 0;
        let average = 0;
        
        while (index < numbers.length) {
          const number = Number(numbers[index]);

          sum += number;

          index++;
        }

        average = sum / (numbers.length - 1);

        console.log(average.toFixed(2));
      }

      // calcAverageNumber(["4", "3", "2", "4", "2"]);
      // calcAverageNumber(["2", "6", "4"]);
      // calcAverageNumber(["3", "82", "43", "22"]);
      // calcAverageNumber(["4", "95", "23", "76", "23"]);

      function calcAverageNumber2(numbers) {
        let index = Number(numbers[0]);
        let sum = 0;
        let average = 0;
        
        while (index > 0) {
          const number = Number(numbers[index]);

          sum += number;

          index--;
        }

        average = sum / (numbers.length - 1);

        console.log(average.toFixed(2));
      }

      // calcAverageNumber2(["4", "3", "2", "4", "2"]);
      // calcAverageNumber2(["2", "6", "4"]);
      // calcAverageNumber2(["3", "82", "43", "22"]);
      // calcAverageNumber2(["4", "95", "23", "76", "23"]);
    </script>
  </body>
</html>