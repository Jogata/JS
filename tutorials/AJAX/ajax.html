<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <style>
      fieldset {
        display: none;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        width: 100%;
        min-height: 100vh;
        /* display: flex; */
        /* align-items: center; */
        /* justify-content: center; */
      }

      #content {
    width: 75%;
    margin: 0 auto;
}

div.forecasts {
    display: inline-block;
    width: 30%;
    border: 1px solid aquamarine;
    border-radius: 4px;
    margin: 2% 2% 0.5% 0.5%;
}

div.forecast-info {
    border: 1px solid aquamarine;
    border-radius: 4px;
    margin-bottom: 1%;
}

#request {
    text-align: center;
}

.bl {
    width: 300px;
}

#current {
    text-align: center;
    font-size: 2em;
}

#upcoming {
    text-align: center;
}

.condition {
    text-align: left;
    display: inline-block;
}

.symbol {
    font-size: 4em;
    display: inline-block;
}

.forecast-data {
    display: block;
}

.upcoming {
    display: inline-block;
    margin: 1.5em;
}

.label {
    margin-top: 1em;
    font-size: 1.5em;
    background-color: aquamarine;
    font-weight: 400;
}

input {
    padding: 10px 12px;
    margin: 5px 0;
    display: inline-block;
    border: 1px solid #ccc;
    border-radius: 4px;
}

input[type=button] {
    background-color: aquamarine;
}
    </style>
  </head>
  <body>

    <div id="container">

      <main id="main">
  
        <div class="profile">

          <img src="./iconProfile2.png" class="userIcon" />
          <label>Lock</label>
          <input type="radio" name="user1Locked" value="lock" checked>
          <label>Unlock</label>
          <input type="radio" name="user1Locked" value="unlock"><br>
          <hr>
          <label>Username</label>
          <input type="text" name="user1Username" value="" disabled readonly />

          <div class="user1Username">
            <hr>
            <label>Email:</label>
            <input type="email" name="user1Email" value="" disabled readonly />
            <label>Age:</label>
            <input type="text" name="user1Age" value="" disabled readonly />
          </div>
          
          <button>Show more</button>

        </div>
  
      </main>

    </div>
    <script>
      window.onload = lockedProfile();
    </script>
  
    <!-- <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1> -->

<script>
  // 10. Contacts Builder✶
  // 11. View Model✶
  // 12. Payment Package
  // 13. String Builder *✶
</script>

    <!-- ================= Get data from local JSON file ================= -->

    <div id="content">
      <div id="request">
          <input id="location" class='bl' type="text">
          <input id="submit" class="bl" type="button" value="Get Weather">
      </div>
      <div id="forecast" style="display:none">
          <div id="current">
              <div class="label">Current conditions</div>
              <!-- <div class="forecasts">
                  <span class="condition symbol"></span>
                  <span class="condition">
                      <span class="forecast-data">london, usa</span>
                      <span class="forecast-data">8deg/19deg</span>
                      <span class="forecast-data">sunny</span>
                  </span>
              </div> -->
          </div>
          <div id="upcoming">
              <div class="label">Three-day forecast</div>
              <!-- <div class="forecast-info">
                  <span class="upcoming">
                      <span class="symbol"></span>
                      <span class="forecast-data">8deg/19deg</span>
                      <span class="forecast-data">sunny</span>
                  </span>
                  <span class="upcoming">
                      <span class="symbol"></span>
                      <span class="forecast-data">8deg/19deg</span>
                      <span class="forecast-data">sunny</span>
                  </span>
                  <span class="upcoming">
                      <span class="symbol"></span>
                      <span class="forecast-data">8deg/19deg</span>
                      <span class="forecast-data">sunny</span>
                  </span>
              </div> -->
          </div>
      </div>
  </div>

<script>
function attachEvents() {
    // console.log("TODO...");
    const submitbtn = document.getElementById("submit");
    const forecastoutput = document.getElementById("forecast");
    
    submitbtn.addEventListener("click", async () => {
        try {
            const locationInput = document.getElementById("location");
            const locationvalue = locationInput.value;

            if (locationvalue.length == 0) {
                throw new Error();
            }

            const response = await fetch("http://localhost:3030/jsonstore/forecaster/locations");

            if (!response.ok) {
                throw new Error();
            }

            const locationsdata = await response.json();
            // console.log(locationsdata);
            const data = Object.entries(locationsdata);
            // console.log(data);

            const location = data.find(x => x[1].name == locationvalue);
            // console.log(location);

            if (!location) {
                throw new Error();
            }

            const code = location[1].code;
            // console.log(code);

            const todayInfoURL = `http://localhost:3030/jsonstore/forecaster/today/${code}`;
            
            const todayInfoResponse = await fetch(todayInfoURL);
            
            const todayInfo = await todayInfoResponse.json();
            // console.log(todayInfo);
            
            const upcomingInfoURL = `http://localhost:3030/jsonstore/forecaster/upcoming/${code}`;

            const upcomingInfoResponse = await fetch(upcomingInfoURL);

            const upcomingInfo = await upcomingInfoResponse.json();
            // console.log(upcomingInfo);

            forecastoutput.style.display = "block";

            const symbols = {
                "Sunny": "&#x2600;", // ☀
                "Partly sunny": "&#x26C5;", // ⛅
                "Overcast": "&#x2601;", // ☁
                "Rain": "&#x2614;", // ☂
                "Degrees": "&#176;" // °
            }
            // console.log(symbols);

            const forecastsDiv = document.createElement("div");
            forecastsDiv.classList.add("forecasts");
            const forecastsHtml = `<span class="condition symbol">${symbols[todayInfo.forecast.condition]}</span><span class="condition"><span class="forecast-data">${todayInfo.name}</span><span class="forecast-data">${todayInfo.forecast.low}${symbols.Degrees}/${todayInfo.forecast.high}${symbols.Degrees}</span><span class="forecast-data">${todayInfo.forecast.condition}</span></span>`;
            forecastsDiv.innerHTML = forecastsHtml;

            const todayWeatherView = document.getElementById("current");
            todayWeatherView.appendChild(forecastsDiv);

            const upcomingDiv = document.createElement("div");
            upcomingDiv.classList.add("forecast-info");

            for (const day of upcomingInfo.forecast) {
                // console.log(day);
                const span = createOneDayInfo(day.condition, day.low, day.high);
                // console.log(span.children);
                upcomingDiv.appendChild(span);
            }

            const upcomingWeatherView = document.getElementById("upcoming");
            upcomingWeatherView.appendChild(upcomingDiv);

        //     `<div class="forecast-info">
        //     <span class="upcoming">
        //         <span class="symbol"></span>
        //         <span class="forecast-data">8deg/19deg</span>
        //         <span class="forecast-data">sunny</span>
        //     </span>
        //     <span class="upcoming">
        //         <span class="symbol"></span>
        //         <span class="forecast-data">8deg/19deg</span>
        //         <span class="forecast-data">sunny</span>
        //     </span>
        //     <span class="upcoming">
        //         <span class="symbol"></span>
        //         <span class="forecast-data">8deg/19deg</span>
        //         <span class="forecast-data">sunny</span>
        //     </span>
        // </div>`

        function createOneDayInfo(condition, low, high) {
            const span = document.createElement("span");
            span.classList.add("upcoming");
            const html = `<span class="symbol">${symbols[condition]}</span><span class="forecast-data">${low}${symbols.Degrees}/${high}${symbols.Degrees}</span><span class="forecast-data">${condition}</span>`;
            // console.log(html);
            span.innerHTML = html;
            return span;
        }

        } catch (error) {
            forecastoutput.textContent = "Error";
            forecastoutput.style.display = "block";
        }
    });

    // function getLocations(url) {
    //     fetch(url)
    //     .then(response => response.json())
    //     .then(data => console.log(data))
    //     .catch(err => console.log(err));
    // }
}

attachEvents();
</script>

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      const matches4 = `
      40 Desert Blade (Fragment)
40 Minotaur's Head (Fragment)
40 Diviner's Orb - Recipe (Fragment)
50 Panoptic Orb - Recipe (Fragment)
80 Hand of Glory (Fragment)

40 Book of Prophecies - Recipe (Fragment)
50 Book of Fate - Recipe (Fragment)
80 Flaming Heart (Fragment)
160 Pastor's Seal (Fragment)

80 Riversar's Tiara (Fragment)
`;
      const matches3 = `740/120/100      640/320/150`;

const patern = /[0-9]+/g;

const result = matches3.match(patern).reduce((acc, n) => acc + Number(n), 0);
console.log(result);
    </script>
  </body>
</html>