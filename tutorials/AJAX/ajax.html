<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
  </head>
  <body>
    <script>
      // 05. Fitness Center

      function manageGym(params) {
        const clients = Number(params[0]);
        
        const options = {
          back: 0,
          chest: 0,
          legs: 0,
          abs: 0,
          "protein shake": 0,
          "protein bar": 0,
          buyers: 0,
        }

        for (let current = 1; current < params.length; current++) {
          let input = params[current].toLowerCase();

          options[input]++;

          if (input === "protein shake" || input === "protein bar") {
            options.buyers++;
          }

        }

        const clientssP = options.buyers / clients * 100;
        const trainingP = 100 - clientssP;

        console.log(`${options.back} - back`);
        console.log(`${options.chest} - chest`);
        console.log(`${options.legs} - legs`);
        console.log(`${options.abs} - abs`);
        console.log(`${options["protein shake"]} - protein shake`);
        console.log(`${options["protein bar"]} - protein bar`);
        console.log(`${trainingP.toFixed(2)}% - work out`);
        console.log(`${clientssP.toFixed(2)}% - protein`);
      }

      // manageGym(["10", "Back", "Chest", "Legs", "Abs", "Protein shake", "Protein bar", "Protein shake", "Protein bar", "Legs", "Abs"]);
      // manageGym(["7", "Chest", "Back", "Legs", "Legs", "Abs", "Protein shake", "Protein bar"]);

      // 05. Tennis Ranklist

      function calcPoints(data) {
        const turniri = Number(data[0]);
        let startingPoints = Number(data[1]);
        let points = startingPoints;
        let etap = "";
        let uspehi = 0;

        const results = {
          W: 2000,
          F: 1200,
          SF: 720,
        }

        for (let index = 2; index < data.length; index++) {
          etap = data[index];

          points += results[result];

          if (etap === "W") {
            uspehi++
          }
          
        }

        const average = Math.floor((points - startingPoints) / turniri);
        const uspehP = uspehi / turniri * 100;

        console.log(`Final points: ${points}`);
        console.log(`Average points: ${average}`);
        console.log(`${uspehP.toFixed(2)}%`);

      }

      calcPoints(["5", "1400", "F", "SF", "W", "W","SF"]);
      calcPoints(["4", "750", "SF", "W", "SF", "W"]);

      // 06. High Jump

      function calcHighJump(data) {
        let end = Number(data[0]);
        let currentTarget = end - 30;
        let isSucessuful = true;
        let broiPosledNeuspOpiti = 0;
        let jumps = 1;

        while (currentTarget <= end) {
          console.log(currentTarget);
          let height = Number(data[jumps]);
          broiPosledNeuspOpiti = 0;
          
          while (height <= currentTarget) {

            console.log("inf");

            if (broiPosledNeuspOpiti === 3) {
              isSucessuful = false;
              end = 0;
              break;
            } else {
              broiPosledNeuspOpiti++;
            jumps++;
            height = Number(data[jumps]);

            }

          }

          if (height > currentTarget) {
            currentTarget += 5;
            jumps++;
          }
          
        }

        if (isSucessuful) {
          console.log("end");
        } else {
          console.log(`Tihomir failed at ${currentTarget}cm after ${jumps} jumps.`);
        }

      }

      // calcHighJump(["250", "225", "224", "225", "228", "231", "235", "234", "235", "250", "255", "235"]);
      // calcHighJump(["231", "205", "212", "213", "228", "229", "230", "235"]);

    </script>

    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>

    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>
  </body>
</html>