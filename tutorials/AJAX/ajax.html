<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      function onTimee(input) {
    let examHour = Number(input[0]);
    let examMinute = Number(input[1]);
    let arrivalHour = Number(input[2]);
    let arraivalMinute = Number(input[3]);
 
 
    let totalExamminutes = (examHour*60) + examMinute ;
    let totalArrivalMinutes = (arrivalHour * 60) + arraivalMinute ;
 
    if (totalArrivalMinutes > totalExamminutes) {
      console.log('Late' );
    }    
    if (totalExamminutes >= totalArrivalMinutes && (totalExamminutes-totalArrivalMinutes) <= 30) {
      console.log('On time');
    }
    if (totalExamminutes > totalArrivalMinutes && (totalExamminutes-totalArrivalMinutes) > 30){
      console.log('Early');
    }
    
    if(totalExamminutes > totalArrivalMinutes && (totalExamminutes - totalArrivalMinutes) <= 59) {
      console.log(`${(totalExamminutes - totalArrivalMinutes)} minutes before the start`);
    }
   
    if (totalExamminutes < totalArrivalMinutes && (totalArrivalMinutes - totalExamminutes <= 59  )) {
      console.log(`${totalArrivalMinutes-totalExamminutes} minutes after the start`);
    }
    
    if (totalExamminutes > totalArrivalMinutes && (totalExamminutes - totalArrivalMinutes >= 60)) {
        totalTime=totalExamminutes -totalArrivalMinutes
        let hour= 0;
        let minutes = 0;
        
        while(totalTime >= 60) {
            if(totalTime >= 60) {
                totalTime -= 60;
                hour++;
            }
        }
        
        if (totalTime <= 59) {
          minutes += totalTime;
        }

        if (minutes>=10){
          console.log( `${hour}:${minutes} hours before the start`);
        } else {
          console.log( `${hour}:0${minutes} hours before the start`);
        }
 
    }

    if (totalArrivalMinutes > totalExamminutes && (totalArrivalMinutes - totalExamminutes) >= 60) { 
        totalTime= totalArrivalMinutes - totalExamminutes;
        let hour= 0;
        let minutes = 0;
        
        while(totalTime >= 60) {
            if(totalTime >= 60) {
                totalTime -= 60;
                hour++;
            }
        }
        
        if (totalTime <= 59) {
          minutes += totalTime;
        }

        if (minutes >= 10) {
          console.log( `${hour}:${minutes} hours after the start`);
        } else {
          console.log( `${hour}:0${minutes} hours after the start`);
        }
      }
    }
      
    // onTimee(["16", "00", "15", "00"]);

    function travelAgency(input){
let destination = input[0];
let packageType = input[1];
let statusVIP = input[2];
let daysNum = Number(input[3]);
let price = 0;
let dayPrice = 100;
 
if (daysNum < 1) {
  console.log(`Days must be positive number!`);
  return;
}

if (packageType !== "withBreakfast" && packageType !== "noBreakfast" && packageType !== "withEquipment" && packageType !== "noEquipment") {
  console.log(`Invalid input!`);
  return;
}

   if (destination === "Bansko" || destination === "Borovets") {
        if (packageType === "withEquipment") {
            if (statusVIP === "no") {
              price = daysNum * 100;
              dayPrice = price / daysNum;
            } else {
              price = daysNum * 100 * 0.90;
              dayPrice = price / daysNum;
            }
          } else if (packageType === "noEquipment") {
            if (statusVIP === "no") {
              price = daysNum * 80;
              dayPrice = price / daysNum;
            } else {
              price = daysNum * 80 * 0.95;
              dayPrice = price / daysNum;
            }
        }
   } else if (destination === "Varna" || destination === "Burgas") {
        if (packageType === "withBreakfast") {
            if (statusVIP === "no") {
              price = daysNum * 130;
              dayPrice = price / daysNum;
            } else {
              price = daysNum * 130 * 0.88;
              dayPrice = price / daysNum;
            }
          } else if (packageType === "noBreakfast") {
            dayPrice = 100;
            if (statusVIP === "no") {
              price = daysNum * 100;
              dayPrice = price / daysNum;
            } else {
              price = daysNum * 100 * 0.93;
              dayPrice = price / daysNum;
            }
        }    
    } else {
        console.log(`Invalid input!`);
        return; 
    }

    if (daysNum >= 7) {
      // daysNum = daysNum - 1;
      price = price - dayPrice;
    }

    console.log(`The price is ${price.toFixed(2)}lv! Have a nice time!`);
}

// travelAgency(["Borovets", "noEquipments", "yes", "6"]);
// travelAgency(["Varna", "withBreakfast", "no", "0"]);
// travelAgency(["Bansko", "withEquipment", "no", "2"]);

    </script>
  </body>
</html>