<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <style>
      @import url(https://fonts.googleapis.com/css?family=Lato:400,300,700|Montserrat:400,700);
      
      fieldset {
        display: none;
      }

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.restaurant-race-class {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  padding: 1.5rem;
  color: #aaa;
}

body {
  font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
  font-family: Georgia, 'Times New Roman', Times, serif;
  background-color: #222;
  background-image: url(./softuni-wallpaper-1-1920x1080.jpg);
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-position: top;
  background-size: cover;
}

h2 {
  font-size: 22px;
  color: white;
  padding: 0.3rem;
}

span {
  width: 25%;
  margin: 0 auto;
  height: 1px;
  display: block;
  border-bottom: 1px solid white;
  margin-bottom: 10px;
  font-size: 22px;
}

textarea {
  background: #fff;
  border-radius: 5px; 
  padding-left: 0.1rem;
  padding-right: 0.1rem;
  border: 1px solid #00BFFF;
  margin-right: 1.2rem;
  outline: none;
  color: black;
  font-size: 21px;
  width: 50%;
  resize: none;
  height: 20vh;
  width: 80%;
  text-align: center;
}

#outputs div, 
#inputs {
  margin: 20px 0px 20px 20px;
  width: 1135px;
  text-align: center;
  padding-bottom: 20px;
  background-color: #fff;
  border-radius: 10px;
  padding-left: 35px;
  box-shadow: rgba(0, 0, 0, .15) 0 1px 3px;
  background: radial-gradient(black, transparent);
  text-shadow: black;
  color:white;
  font-size: 22px;
  border-bottom: 1px solid white;
  border-left: 1px solid white;
  border-top: 1px solid black;
  border-right: 1px solid black;
}

label {
  font-size: 18px;
}

button {
  font-size: 22px;
  margin-top: 10px;
  margin-left: 5px;
  background-color: #03496B;
  outline: none;
  border-top-right-radius: 25%;
  border-bottom-left-radius: 40%;
  border-top-color: white;
  border-bottom-color: white;
  padding: 0.5em 1em;
  color: #fff;
  font-family: inherit;
  transition: all 0.4s ease-in;
  cursor: pointer;
}
button:hover {
  box-shadow: 0px 1px 7px 4px white;
}
button:active {
  box-shadow: 0px 1px 2px 1px white;
}
  </style>
  </head>
  <body>
    <!-- <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1> -->

    <section class="restaurant-race-class">

      <div id="inputs">
          <h2>Add workers</h2>
          <textarea></textarea>
          <br>
          <button type="submit" id="btnSend">Send</button>
      </div>
      
      <div id="outputs">
          <div id="bestRestaurant">
              <h2>Best Restaurant</h2>
              <span></span>
              <p></p>
          </div>
          <div id="workers">
              <h2>Best Restaurant's workers</h2>
              <span></span>
              <p></p>
          </div>
      </div>

  </section>
    <script>
      window.addEventListener("load", () => {
        solve();
      })

      function solve() {
 document.querySelector('#btnSend').addEventListener('click', onClick);

 function onClick () {
    //   TODO:
    const textarea = document.querySelector("textarea");
    const restaurantsData = JSON.parse(textarea.value);
    // console.log(restaurantsData);
    const restaurants = [];

    for (const data of restaurantsData) {
       // console.log(data);
       const tokens = data.split(" - ");
       // console.log(tokens);
       const restaurantName = tokens[0];
       const workersDataString = tokens[1];
       const workersDataArr = workersDataString.split(", ");

       if (!restaurants.some(x => x.name == restaurantName)) {
          const restaurant = {
             name: restaurantName, 
             workers: [], 
             averageSalary: 0
          }

          restaurants.push(restaurant);

       }

       const workers = restaurants.find(x => x.name == restaurantName).workers;

       for (const data of workersDataArr) {
          const tokens = data.split(" ");
          const name = tokens[0];
          const salary = Number(tokens[1]);

          const worker = {
             name, 
             salary
          };

          // console.log(worker);
          workers.push(worker);
       }

    }

    for (const restaurant of restaurants) {         
       const sortedWorkers = restaurant.workers.sort((a, b) => b.salary - a.salary);
       // console.log(sortedWorkers);
 
       let total = 0;
       
       for (const worker of sortedWorkers) {
          total += worker.salary;
       }
 
       const averageSalary = total / sortedWorkers.length;
       // console.log(averageSalary);
       restaurant.averageSalary = averageSalary;
    }

    const sortedRestaurants = restaurants.sort((a, b) => b.averageSalary - a.averageSalary);
    // console.log(sortedRestaurants);
    const theBest = restaurants[0];
    // console.log(theBest);

    const output1 = document.querySelector("#bestRestaurant p");
    // console.log(`Name: ${theBest.name} Average Salary: ${theBest.averageSalary.toFixed(2)} Best Salary: ${theBest.sortedWorkers[0].salary.toFixed(2)}`);
    output1.textContent = `Name: ${theBest.name} Average Salary: ${theBest.averageSalary.toFixed(2)} Best Salary: ${theBest.workers[0].salary.toFixed(2)}`;

    const output2 = document.querySelector("#workers p");

    const theBestRestWorkers = theBest.workers.map(worker => {
       return `Name: ${worker.name} With Salary: ${worker.salary}`;
    });

    output2.textContent = theBestRestWorkers.join(" ");

 }
}
  </script>

<script>
  class RefurbishedSmartphones {
      constructor(retailer) {
          this.retailer = retailer;
          this.availableSmartphones = [];
          this.soldSmartphones = [];
          this.revenue = 0;
      }

      addSmartphone (model, storage, price, condition) {
          if (model.length == 0 || typeof model != "string") {
              throw new Error("Invalid smartphone!");
          }
          if (storage < 0 || !Number.isInteger(storage)) {
              throw new Error("Invalid smartphone!");
          }
          if (price < 0 || typeof price != "number") {
              throw new Error("Invalid smartphone!");
          }
          if (condition.length == 0 || typeof condition != "string") {
              throw new Error("Invalid smartphone!");
          }

          const smartphone = {
              model, 
              storage, 
              price, 
              condition
          }

          this.availableSmartphones.push(smartphone);

          return `New smartphone added: ${model} / ${storage} GB / ${condition} condition - ${price.toFixed(2)}$`;

      }

      sellSmartphone (model, desiredStorage) {

          const index = this.availableSmartphones.findIndex(phhone => phhone.model == model);
          // console.log(index);

          if (index < 0) {
              throw new Error(`${model} was not found!`);
          }

          const phone = this.availableSmartphones[index];

          if (desiredStorage > phone.storage) {
              
              if (desiredStorage - phone.storage <= 128) {
                  phone.price *= 0.9;
              } else {
                  phone.price *= 0.8;
              }

          }

          this.availableSmartphones.splice(index, 1);

          const soldedPhone = {
              model: phone.model, 
              storage: phone.storage, 
              soldPrice: phone.price
          }
          this.soldSmartphones.push(soldedPhone);

          this.revenue += phone.price;

          return `${model} was sold for ${soldedPhone.soldPrice.toFixed(2)}$`;

      }

      upgradePhones () {

          if (this.availableSmartphones.length == 0) {
              throw new Error("There are no available smartphones!");
          }

          const updatedInfo = ["Upgraded Smartphones:"];

          for (const smartphone of this.availableSmartphones) {
              // console.log(smartphone);
              smartphone.storage *= 2;
              const info = `${smartphone.model} / ${smartphone.storage} GB / ${smartphone.condition} condition / ${smartphone.price.toFixed(2)}$`;
              // console.log(info);
              updatedInfo.push(info);
          }

          return updatedInfo.join("\n");

      }

      salesJournal (criteria) {

          if (criteria != "storage" && criteria != "model") {
              throw new Error("Invalid criteria!");
          }

          const journal = [`${this.retailer} has a total income of ${this.revenue.toFixed(2)}$`, `${this.soldSmartphones.length} smartphones sold:`];

          if (criteria == "model") {
              this.soldSmartphones.sort((p1, p2) => p1.model.localeCompare(p2.model));
          } else {
              this.soldSmartphones.sort((p1, p2) => p2.storage - p1.storage);
          }

          for (const smartphone of this.soldSmartphones) {
              // console.log(smartphone);
              const info = `${smartphone.model} / ${smartphone.storage} GB / ${smartphone.soldPrice.toFixed(2)}$`;
              journal.push(info);
          }

          return journal.join("\n");

      }

  }

  // let retailer = new RefurbishedSmartphones('SecondLife Devices');
  // console.log(retailer.addSmartphone('Samsung S20 Ultra', 256, 1000, 'good'));
  // console.log(retailer.addSmartphone('Iphone 12 mini', 128, 800, 'perfect'));
  // console.log(retailer.addSmartphone('', 512, 1900, 'good'));

  // let retailer = new RefurbishedSmartphones('SecondLife Devices');
  // console.log(retailer.addSmartphone('Samsung S20 Ultra', 256, 1000, 'good'));
  // console.log(retailer.addSmartphone('Iphone 12 mini', 128, 800, 'perfect'));
  // console.log(retailer.addSmartphone('Xiaomi Redmi Note 10 Pro', 128, 330, 'perfect'));
  // console.log(retailer.sellSmartphone('Samsung S20 Ultra', 256));
  // console.log(retailer.sellSmartphone('Xiaomi Redmi Note 10 Pro', 256));
  // console.log(retailer.sellSmartphone('Samsung Galaxy A13', 64));

  // let retailer = new RefurbishedSmartphones('SecondLife Devices');
  // console.log(retailer.upgradePhones());

  // let retailer = new RefurbishedSmartphones('SecondLife Devices');
  // retailer.addSmartphone('Samsung S20 Ultra', 256, 1000, 'good');
  // retailer.addSmartphone('Iphone 12 mini', 128, 800, 'perfect');
  // retailer.addSmartphone('Xiaomi Redmi Note 10 Pro', 128, 330, 'perfect');
  // console.log(retailer.upgradePhones());

  // let retailer = new RefurbishedSmartphones('SecondLife Devices');
  // retailer.addSmartphone('Samsung S20 Ultra', 256, 1000, 'good');
  // retailer.addSmartphone('Iphone 12 mini', 128, 800, 'perfect');
  // retailer.addSmartphone('Xiaomi Redmi Note 10 Pro', 128, 330, 'perfect');
  // retailer.sellSmartphone('Samsung S20 Ultra', 256);
  // retailer.sellSmartphone('Xiaomi Redmi Note 10 Pro', 256);
  // console.log(retailer.salesJournal('model'));
  // console.log(retailer.salesJournal('storage'));
  // console.log(retailer.salesJournal('storage1'));
  // console.log(retailer.salesJournal('model1'));

  // const RefurbishedSmartphones = result;
  let smartphone = new RefurbishedSmartphones("SecondLife Devices");
  console.log(smartphone.addSmartphone('Samsung S20 Ultra', 256, 1000, 'good'));
  console.log(smartphone.addSmartphone('Iphone 12 mini', 128, 800, 'perfect'));
  console.log(smartphone.addSmartphone('Xiaomi Redmi Note 10 Pro', 128, 330, 'perfect'));
  console.log(smartphone.sellSmartphone('Samsung S20 Ultra', 256));
  console.log(smartphone.sellSmartphone('Xiaomi Redmi Note 10 Pro', 256));
  console.log(smartphone.sellSmartphone('Samsung Galaxy A13', 64));
</script>

<script>
  // 10. Contacts Builder✶
  // 11. View Model✶
  // 12. Payment Package
  // 13. String Builder *✶
</script>

    <!-- ================= Get data from local JSON file ================= -->

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      const matches4 = `
      40 Desert Blade (Fragment)
40 Minotaur's Head (Fragment)
40 Diviner's Orb - Recipe (Fragment)
50 Panoptic Orb - Recipe (Fragment)
80 Hand of Glory (Fragment)

40 Book of Prophecies - Recipe (Fragment)
50 Book of Fate - Recipe (Fragment)
80 Flaming Heart (Fragment)
160 Pastor's Seal (Fragment)

80 Riversar's Tiara (Fragment)
`;
      const matches3 = `740/120/100      640/320/150`;

const patern = /[0-9]+/g;

const result = matches3.match(patern).reduce((acc, n) => acc + Number(n), 0);
console.log(result);
    </script>
  </body>
</html>