<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  </head>
  <body>
    <!-- <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1> -->

    <script>
      // 06. List Of Names
      
      function createList(names) {
        const sorted = names.sort((x, y) => x.localeCompare(y));
        // console.log(sorted);
        
        for (let index = 0; index < sorted.length; index++) {
          console.log(`${index + 1}.${sorted[index]}`);
        }
        
      }
      
      // createList(["John", "Bob", "Christina", "Ema"]);

        // 05. Functional Sum

  function sum(num) {
    let n1 = 0;
    n1 += num;
    Function.prototype.toString = function () {
      return n1;
    }
    // console.log(n1);
    return function inner (num) {
      n1 += num;
      // console.log(n1);
      return inner;
    }
  }

  function add(num) {
let sum = num;

function calc(num2) {
    sum += num2;
    return calc;
}

calc.toString = function() { return sum };
return calc;
}

  // console.log(sum(1));
  // console.log(sum(1)(6)(-3));
  // sum(1)(6)(-3);

  // 04. Ascii Sumator

function asciiSumator(params) {
// console.log(params);
const symbol1 = params[0];
const symbol2 = params[1];
const word = params[2];
// console.log(start, end, word);
const ascii1 = symbol1.charCodeAt(0);
const ascii2 = symbol2.charCodeAt(0);
// console.log(ascii1, ascii2);

const min = Math.min(ascii1, ascii2);
const max = Math.max(ascii1, ascii2);
// console.log(min, max);

let sum = 0;

for (const letter of word) {
  // console.log(letter);
  const ascii = letter.charCodeAt(0);
  // console.log(ascii);
  if (ascii > min && ascii < max) {
    sum += ascii;
  }
}

console.log(sum);

}

// asciiSumator(['.', '@', 'dsg12gr5653feee5']);
// asciiSumator(['?', 'E', '@ABCEF']);
// asciiSumator(['a', '1', 'jfe392$#@j24ui9ne#@$']);
      
      // 01. Rectangle

      class Rectangle {
        constructor(width, height, color) {
          this.width = width;
          this.height = height;
          this.color = color;
        }

        calcArea() {
          return this.width * this.height;
        }

      }

      // let rect = new Rectangle(4, 5, 'Red');
      // console.log(rect.width);
      // console.log(rect.height);      
      // console.log(rect.color);
      // console.log(rect.calcArea());

      // 02. Data Class

      class Request {
        constructor(method, uri, version, message) {
          this.method = method;
          this.uri = uri;
          this.version = version;
          this.message = message;
          this.response = undefined;
          this.fulfilled = false;
        }
      }

      // let myData = new Request('GET', 'http://google.com', 'HTTP/1.1', '');
      // console.log(myData);
      
      // 03. Tickets

      function menageTickets(arr, criteria) {
        const tickets = [];

        class Ticket {
          constructor(destination, price, status) {
            this.destination = destination;
            this.price = price;
            this.status = status;
          }
        }

        for (const input of arr) {
          // console.log(input);
          const tokens = input.split("|");
          // console.log(tokens);
          const destination = tokens[0];
          const price = Number(tokens[1]);
          const status = tokens[2];
          // console.log(destination, price, status);

          const ticket = new Ticket(destination, price, status);
          // console.log(ticket instanceof Ticket);
          tickets.push(ticket);
        }

        // console.log(tickets);

        if (criteria == "price") {
          return tickets.sort((a, b) => a[criteria] - b[criteria]);
        } else {
          return tickets.sort((a, b) => a[criteria].localeCompare(b[criteria]));
        }
        // const sorted = tickets.sort();

        // tickets.map(ticket => ticket[criteria]);
        // console.log(tickets);

        // return sorted;

      }

      // console.log(menageTickets(
      //   [
      //     'Philadelphia|94.20|available', 
      //     'New York City|95.99|available', 
      //     'New York City|95.99|sold', 
      //     'Boston|126.20|departed'
      //   ], 'destination'
      //   ));
      // console.log(menageTickets(
      //   [
      //     'Philadelphia|94.20|available', 
      //     'New York City|95.99|available', 
      //     'New York City|95.99|sold', 
      //     'Boston|126.20|departed'
      //   ], 'destination'
      //   ));

      // 04. Sorted List

      class List {
        constructor() {
          this.list = [];
          this.size = this.list.length;
        }

        add(num) {
          this.list.push(num);
          this.size++;
          this.list.sort((a, b) => a - b);
          // console.log(this.list);
          return this.list;
        }

        remove(index) {
          // this.list[index] = null;
          if (index >= 0 && index < this.list.length) {
            this.list.splice(index, 1);
            this.size--;
            // console.log(this.list);
          }
          return this.list;
        }

        get(index) {
          if (index >= 0 && index < this.list.length) {
            // console.log(this.list.length);
            return this.list[index];
          } 
          // else {
            // throw new Error();
          // }
        }

      }

      // let list = new List();
      // list.add(5);
      // list.add(7);
      // list.add(6);
      // console.log(list.get(1));
      // list.remove(1);
      // console.log(list.get(1));
      // console.log(list.size);
      
      // 05. Length Limit

      class Stringer {
        constructor(str, length) {
          this.innerString = str;
          this.innerLength = length;
        }

        increase(num) {
          this.innerLength += num;
        }

        decrease(num) {
          if (num > this.innerLength) {
            this.innerLength = 0;
          } else {
            this.innerLength -= num;
          }
        }

        toString() {
          
          if (this.innerLength == 0) {
            return "...";
          }

          let newString = this.innerString.substring(0, this.innerLength);

          if (this.innerString.length > this.innerLength) {
            newString += "...";
          }

          return newString;

        }

      }

      // let test = new Stringer("Test", 5);
      // console.log(test.toString()); // Test
      // test.decrease(3);
      // console.log(test.toString()); // Te...
      // test.decrease(5);
      // console.log(test.toString()); // ...
      // test.increase(4);
      // console.log(test.toString()); // Test
      // console.log(test);

      // 06. Company

      class Company {
        constructor() {
          this.departments = {};
        }

        addEmployee(name, salary, position, department) {
          
          if (!name || !salary || !position || !department) {
            throw new Error("Invalid input!");
          }

          if (salary < 0) {
            throw new Error("Invalid input!");
          }

          if (!this.departments[department]) {
            this.departments[department] = [];
          }

          const employee = {
            name, 
            salary, 
            position
          }

          // console.log(this.departments[department]);
          this.departments[department].push(employee);

          // console.log(`New employee is hired. Name: ${name}. Position: ${position}`);
          return `New employee is hired. Name: ${name}. Position: ${position}`;

        }

        bestDepartment() {
          const departmentsInfo = [];

          for (const key in this.departments) {
            // console.log(key);
            const department = this.departments[key];
            // console.log(department);

            let total = 0;
            let average = 0;

            for (const employee of department) {
              // console.log(employee, key);
              total += employee.salary;
            }

            // console.log(total);
            average = total / department.length;
            // console.log(average);
            const departmentInfo = {
              key, 
              average
            }

            departmentsInfo.push(departmentInfo);
            // console.log(departmentsInfo);
          }

          departmentsInfo.sort((dep1, dep2) => dep2.average - dep1.average);
          // console.log(departmentsInfo);
          const theBestName = departmentsInfo[0].key;
          const theBestAverage = departmentsInfo[0].average;
          const theBest = this.departments[theBestName];
          theBest.sort((emp1, emp2) => emp2.salary - emp1.salary || emp1.name.localeCompare(emp2.name));
          // console.log(theBestName, theBestAverage, theBest);

          let result = `Best Department is: ${theBestName}\n`;
          result += `Average salary: ${theBestAverage.toFixed(2)}\n`;

          for (const employee of theBest) {
            // console.log(employee);
            const employeeInfo = `${employee.name} ${employee.salary} ${employee.position}\n`;
            // console.log(employeeInfo);
            result += employeeInfo;
          }


          return result.trim();

        }
      }

      // let c = new Company();
      // c.addEmployee("Stanimir", 2000, "engineer", "Construction");
      // c.addEmployee("Pesho", 1500, "electrical engineer", "Construction");
      // c.addEmployee("Slavi", 500, "dyer", "Construction");
      // c.addEmployee("Stan", 2000, "architect", "Construction");
      // c.addEmployee("Stanimir", 1200, "digital marketing manager", "Marketing");
      // c.addEmployee("Pesho", 1000, "graphical designer", "Marketing");
      // c.addEmployee("Gosho", 1350, "HR", "Human resources");
      // console.log(c.departments);
      // console.log(c.bestDepartment());

      // 07. HEX
      // 08. Juice Flavors

      function createJuice(arr) {
        // console.log(arr);

        class Juice {
          constructor() {
            this.flavors = {};
            this.juices = {};
          }

          addFlavor(flavor, quantity) {
            // console.log(flavor, quantity);
            
            if (typeof this.flavors[flavor] != "number") {
              this.flavors[flavor] = 0;
              // console.log(this.flavors);
            }

            // console.log(this.flavors);

            let currentFlavor = this.flavors[flavor];
            // console.log(currentFlavor);
            currentFlavor += quantity;
            // console.log(currentFlavor);

            if (currentFlavor >= 1000) {
              const bottles = Math.floor(currentFlavor / 1000);
              // console.log(bottles);

              if (typeof this.juices[flavor] != "number") {
                this.juices[flavor] = 0;
                // console.log(this.juices);
              }
              
              this.juices[flavor] += bottles;
              // console.log(this.juices);
              currentFlavor = currentFlavor % 1000;
              // console.log(currentFlavor);
            }

            this.flavors[flavor] = currentFlavor;

          }
        }

        const menager = new Juice();

        for (const input of arr) {
          // console.log(input);
          const tokens = input.split(" => ");
          // console.log(tokens);
          const name = tokens[0];
          const quantity = Number(tokens[1]);
          // console.log(name, quantity);
          menager.addFlavor(name, quantity);
        }

        // console.log(menager.flavors);
        // console.log(menager.juices);
        const juiceNames = Object.keys(menager.juices);

        for (const juiceName of juiceNames) {
          // console.log(juiceName);
          console.log(`${juiceName} => ${menager.juices[juiceName]}`);
        }

      }

      // createJuice(
      //   [
      //     'Kiwi => 234',
      //     'Pear => 2345',
      //     'Watermelon => 3456',
      //     'Kiwi => 4567',
      //     'Pear => 5678',
      //     'Watermelon => 6789'
      //   ]
      // );
      // createJuice(
      //   [
      //     'Orange => 2000',
      //     'Peach => 1432',
      //     'Banana => 450',
      //     'Peach => 600',
      //     'Strawberry => 549'
      //   ]
      // );
          
      // 09. Auto-Engineering Company

      function menageCarCompany(params) {
        // console.log(params);
        class IdontKnow {
          constructor() {
            this.brands = {};
          }

          addBrand(data) {
            const tokens = data.split(" | ");
            // console.log(tokens);
            const brand = tokens[0];
            const model = tokens[1];
            const count = Number(tokens[2]);

            if (!this.brands.hasOwnProperty(brand)) {
              this.brands[brand] = {};
            }

            this.addModel(brand, model, count);

          }

          addModel(brand, model, number) {
            if (!this.brands[brand].hasOwnProperty(model)) {
              this.brands[brand][model] = 0;
            }

            this.brands[brand][model] += number;

          }

        }

        const menager = new IdontKnow();

        for (const input of params) {
          // console.log(input);
          menager.addBrand(input);
        }

        // console.log(menager.brands);
        const brands = Object.keys(menager.brands);
        
        for (const brandName of brands) {
          const models = Object.keys(menager.brands[brandName]);
          // console.log(models);
          console.log(brandName);
          for (const modelName of models) {
            console.log(`###${modelName} -> ${menager.brands[brandName][modelName]}`);
          }
        }

      }

      menageCarCompany(
        [
          'Audi | Q7 | 1000',
          'Audi | Q6 | 100',
          'BMW | X5 | 1000',
          'BMW | X6 | 100',
          'Citroen | C4 | 123',
          'Volga | GAZ-24 | 1000000',
          'Lada | Niva | 1000000',
          'Lada | Jigula | 1000000',
          'Citroen | C4 | 22',
          'Citroen | C5 | 10'
        ]
      );

      // 10. Contacts Builder✶
      // 11. View Model✶
      // 12. Payment Package
      // 13. String Builder *✶
    </script>

    <!-- ================= Get data from local JSON file ================= -->

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      const matches4 = `
      40 Desert Blade (Fragment)
40 Minotaur's Head (Fragment)
40 Diviner's Orb - Recipe (Fragment)
50 Panoptic Orb - Recipe (Fragment)
80 Hand of Glory (Fragment)

40 Book of Prophecies - Recipe (Fragment)
50 Book of Fate - Recipe (Fragment)
80 Flaming Heart (Fragment)
160 Pastor's Seal (Fragment)

80 Riversar's Tiara (Fragment)
`;
      const matches3 = `740/120/100      640/320/150`;

const patern = /[0-9]+/g;

const result = matches3.match(patern).reduce((acc, n) => acc + Number(n), 0);
console.log(result);
    </script>
  </body>
</html>