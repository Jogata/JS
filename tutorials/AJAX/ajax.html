<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
  </head>
  <body>
    <!-- <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1> -->
    <script>
      // 01. Request Validator

      function validateRequest(request) {
      //   const request = {
      //   method: 'GET',
      //   // uri: 'svn.public.catalog',
      //   uri: "value", 
      //   version: 'HTTP/1.1',
      //   message: ''
      // };

      const methods = ["GET", "POST", "DELETE", "CONNECT"];
      const uriPattern = /^[\w.]+$/g;
      
      if (!methods.includes(request.method)) {
        // console.log("yes");
        throw new Error(`Invalid request header: Invalid Method`);
      }
      
      // if (!request.uri == "*") {
      //   throw new Error(`Invalid request header: Invalid URI`);
      // }
      if (!request.uri || !request.uri == "*" || !request.uri.match(uriPattern)) {
        throw new Error(`Invalid request header: Invalid URI`);
      }

      const versions = ["HTTP/0.9", "HTTP/1.0", "HTTP/1.1", "HTTP/2.0"];
      
      if (!versions.includes(request.version)) {
        // console.log("yes");
        throw new Error(`Invalid request header: Invalid Version`);
      }

      if (!request.hasOwnProperty("message")) {
        throw new Error(`Invalid request header: Invalid Message`);
      }

      const invalidSymbols = ["<", ">", "\\", "&", `'`, `"`];

      for (const el of request.message) {
        if (invalidSymbols.includes(el)) {
          throw new Error(`Invalid request header: Invalid Message`);
        }
      }
      
      // console.log(request);
        return request;

      }

      // validateRequest({
      //   method: 'GET',
      //   uri: `*`,
      //   version: 'HTTP/1.1',
      //   message: ''
      // });
      // validateRequest({
      //   method: 'OPTIONS',
      //   uri: 'git.master',
      //   version: 'HTTP/1.1',
      //   message: '-recursive'
      // })
      // validateRequest({
      //   method: 'POST', 
      //   uri: 'home.bash', 
      //   message: 'rm -rf /*'
      // })

      // 02. Even Or Odd

      function isOddOrEven(string) {

        if (typeof(string) !== 'string') {
          
          return undefined;
          
        }
        
        if (string.length % 2 === 0) {
          
          return "even";
          
        }
        
        return "odd";
        
      }

//       describe('test isOddOrEven function', function () {
//     it('returns Odd', function () {
//         expect(isOddOrEven("testodd")).to.equal("odd");
//     })
//     it('returns Even', function () {
//         expect(isOddOrEven("testeven")).to.equal("even");
//     })
//     it('returns undefined', function () {
//         expect(isOddOrEven({})).to.equal(undefined);
//         expect(isOddOrEven(0)).to.equal(undefined);
//         expect(isOddOrEven([])).to.equal(undefined);
//     })
// })

      // 03. Char Lookup

      function lookupChar(string, index) {

        if (typeof(string) !== 'string' || !Number.isInteger(index)) {
          
          return undefined;
          
        }
        
        if (string.length <= index || index < 0) { 
          return "Incorrect index";
        } 
        
        return string.charAt(index);

      };

      // console.log(lookupChar("abc", 1));
      // console.log(lookupChar("", 0));
      // console.log(lookupChar("abc", 3.3));
      // console.log(lookupChar("abc", "a"));
      // console.log(lookupChar("abc", 4));
      // console.log(lookupChar("abc", -4));
      // console.log(lookupChar(4, 1));

      // 04. Math Enforcer
      // 05. Notification
      // 06. Dynamic Validation
      // 07. Form Validation
    </script>

    <!-- ================= Get data from local JSON file ================= -->

    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script>
      const matches4 = `
      40 Desert Blade (Fragment)
40 Minotaur's Head (Fragment)
40 Diviner's Orb - Recipe (Fragment)
50 Panoptic Orb - Recipe (Fragment)
80 Hand of Glory (Fragment)

40 Book of Prophecies - Recipe (Fragment)
50 Book of Fate - Recipe (Fragment)
80 Flaming Heart (Fragment)
160 Pastor's Seal (Fragment)

80 Riversar's Tiara (Fragment)
`;
      const matches3 = `740/120/100      640/320/150`;

const patern = /[0-9]+/g;

const result = matches3.match(patern).reduce((acc, n) => acc + Number(n), 0);
console.log(result);
    </script>
  </body>
</html>