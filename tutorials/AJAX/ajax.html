<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX | XMLHttpRequest</title>
    <style>
      h1 {
        text-align: center;
      }
      h1 span {
        display: inline-block;
        margin-right: 10px;
        padding-right: 20px;
        border-right: 2px solid;
      }
      button {
        padding: 5px 10px;
        border-radius: 5px;
      }
      fieldset {
        margin: 2rem auto;
      }
    </style>
  </head>
  <body>
    <h1><span>AJAX</span> XMLHttpRequest(HTTPMethod, url, )</h1>
    <!-- ================= Get data from local JSON file ================= -->
    <fieldset>
      <legend>Get all users from local JSON file</legend>
      <button id="local">Send Request</button>
    </fieldset>

    <script>
      const btnLocalJSON = document.querySelector("#local");
      btnLocalJSON.addEventListener("click", getAllUsersFromLocalFile);

      function getAllUsersFromLocalFile() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const responseAsObject = JSON.parse(this.responseText);
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'users.js', true);
        users.send();
      }
    </script>

    <!-- ================= Get data from GitHub API ================= -->
    <fieldset>
      <legend>Get users from GitHub API</legend>
      <button id="github">Send Request</button>
      <span id="userGithub"></span>
    </fieldset>

    <script>
      const btnGithub = document.querySelector("#github");
      btnGithub.addEventListener("click", getUsersFromGithub);

      function getUsersFromGithub() {
        const users = new XMLHttpRequest();

        users.onload = function () {
          if (this.status === 200) {
            try {
              const usersAsArray = JSON.parse(this.responseText);
              const display = document.querySelector("#userGithub");
              const randomIndex = Math.floor(Math.random() * 30);
              display.textContent = usersAsArray[randomIndex].login;
            } catch (error) {
              console.warn('Did not parse the data!');
            }
          } else {
            console.warn('Did not receive the data!');
          }
        };
  
        users.open('get', 'https://api.github.com/users', true);
        users.send();
      }
    </script>

    <script></script>

    <script>
      const params1 = ``.split("\n");
      const params2 = ``.split("\n");
      const params3 = ``.split("\n");

      // 04. Trekking Mania

      function calcClimbers(params) {
        const groups = Number(params[0]);
        let climbers = 0;
        let mu = 0;
        let mo = 0;
        let ki = 0;
        let k2 = 0;
        let ev = 0;

        for (let group = 1; group <= groups; group++) {
          let current = Number(params[group]);
          climbers += current;

          if (current <= 5) {
            mu += current;
          } else if (current <= 12) {
            mo += current;
          } else if (current <= 25) {
            ki += current;
          } else if (current <= 40) {
            k2 += current;
          } else if (current > 40) {
            ev += current;
          }
        }

          let muP = mu / climbers * 100;
          let moP = mo / climbers * 100;
          let kiP = ki / climbers * 100;
          let k2P = k2 / climbers * 100;
          let evP = ev / climbers * 100;

          console.log(`${muP.toFixed(2)}%`);
          console.log(`${moP.toFixed(2)}%`);
          console.log(`${kiP.toFixed(2)}%`);
          console.log(`${k2P.toFixed(2)}%`);
          console.log(`${evP.toFixed(2)}%`);
      }

      // calcClimbers(params1);
      // calcClimbers(params2);

      // 03. Fitness Card

      function calcMembershipPrice(params) {
        const money = Number(params[0]);
        const gendre = params[1];
        const age = Number(params[2]);
        const sport = params[3];
        let price = 0;

        if (gendre === "m") {
          switch (sport) {
            case "Gym":
              price += 42;
              break;
            case "Boxing":
              price += 41;
              break;
            case "Yoga":
              price += 45;
              break;
            case "Zumba":
              price += 34;
              break;
            case "Dances":
              price += 51;
              break;
            case "Pilates":
              price += 39;
              break;
          }
        } else if (gendre === "f") {
          switch (sport) {
            case "Gym":
              price += 35;
              break;
            case "Boxing":
              price += 37;
              break;
            case "Yoga":
              price += 42;
              break;
            case "Zumba":
              price += 31;
              break;
            case "Dances":
              price += 53;
              break;
            case "Pilates":
              price += 37;
              break;
          }
        }

        if (age <= 19) {
          price = price * 0.8;
        }

        if (price <= money) {
          console.log(`You purchased a 1 month pass for ${sport}.`);
        } else {
          const diff = price - money;
          console.log(`You don't have enough money! You need $${diff.toFixed(2)} more.`);
        }
      }

      // calcMembershipPrice(["50", "m", "23", "Gym"]);
      // calcMembershipPrice(["20", "f", "15", "Yoga"]);
      // calcMembershipPrice(["10", "m", "50", "Pilates"]);

      // 02. Mountain Run

      function climbing(params) {
        const record = Number(params[0]);
        const distance = Number(params[1]);
        const timePerMeter = Number(params[2]);

        let totalTime = distance * timePerMeter;
        let zabavqniq = Math.floor(distance / 50) * 30;
        totalTime += zabavqniq;

        if (totalTime < record) {
          console.log(`Yes! The new record is ${(totalTime).toFixed(2)} seconds.`);
        } else {
          const diff = totalTime - record;
          console.log(`No! He was ${diff.toFixed(2)} seconds slower.`);
        }
      }

      // climbing(["10164", "1400", "25"]);
      // climbing(["5554.36", "1340", "3.23"]);
      // climbing(["1377", "389", "3"]);

      const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;
      console.log(isDarkMode);

    </script>


  </body>
</html>